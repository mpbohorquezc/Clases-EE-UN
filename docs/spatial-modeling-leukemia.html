<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Spatial modeling leukemia | Patrones Puntuales</title>
  <meta name="description" content="Chapter 3 Spatial modeling leukemia | Patrones Puntuales" />
  <meta name="generator" content="bookdown 0.30 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Spatial modeling leukemia | Patrones Puntuales" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Spatial modeling leukemia | Patrones Puntuales" />
  
  
  

<meta name="author" content="Martha Bohorquez" />


<meta name="date" content="2022-12-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="simulación-proceso-espacio-temporal.html"/>
<link rel="next" href="modelos-de-regresión-espacial.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Cuadernos R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introducción</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#indice"><i class="fa fa-check"></i><b>1.1</b> Indice</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="simulación-proceso-espacio-temporal.html"><a href="simulación-proceso-espacio-temporal.html"><i class="fa fa-check"></i><b>2</b> Simulación Proceso Espacio Temporal</a>
<ul>
<li class="chapter" data-level="2.1" data-path="simulación-proceso-espacio-temporal.html"><a href="simulación-proceso-espacio-temporal.html#funciones"><i class="fa fa-check"></i><b>2.1</b> Funciones</a></li>
<li class="chapter" data-level="2.2" data-path="simulación-proceso-espacio-temporal.html"><a href="simulación-proceso-espacio-temporal.html#ch-1-no-separable"><i class="fa fa-check"></i><b>2.2</b> CH 1 no separable</a></li>
<li class="chapter" data-level="2.3" data-path="simulación-proceso-espacio-temporal.html"><a href="simulación-proceso-espacio-temporal.html#ch3-no-separable"><i class="fa fa-check"></i><b>2.3</b> CH3 no separable</a></li>
<li class="chapter" data-level="2.4" data-path="simulación-proceso-espacio-temporal.html"><a href="simulación-proceso-espacio-temporal.html#ch-4"><i class="fa fa-check"></i><b>2.4</b> CH 4</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="spatial-modeling-leukemia.html"><a href="spatial-modeling-leukemia.html"><i class="fa fa-check"></i><b>3</b> Spatial modeling leukemia</a>
<ul>
<li class="chapter" data-level="3.1" data-path="spatial-modeling-leukemia.html"><a href="spatial-modeling-leukemia.html#mortality"><i class="fa fa-check"></i><b>3.1</b> <strong>Mortality</strong></a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="spatial-modeling-leukemia.html"><a href="spatial-modeling-leukemia.html#packages-mortality"><i class="fa fa-check"></i><b>3.1.1</b> <em>Packages Mortality</em></a></li>
<li class="chapter" data-level="3.1.2" data-path="spatial-modeling-leukemia.html"><a href="spatial-modeling-leukemia.html#code-mortality"><i class="fa fa-check"></i><b>3.1.2</b> <em>Code Mortality</em></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="spatial-modeling-leukemia.html"><a href="spatial-modeling-leukemia.html#incidence"><i class="fa fa-check"></i><b>3.2</b> Incidence</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="spatial-modeling-leukemia.html"><a href="spatial-modeling-leukemia.html#packages-incidence"><i class="fa fa-check"></i><b>3.2.1</b> <strong>Packages Incidence</strong></a></li>
<li class="chapter" data-level="3.2.2" data-path="spatial-modeling-leukemia.html"><a href="spatial-modeling-leukemia.html#code-incidence"><i class="fa fa-check"></i><b>3.2.2</b> <em>Code Incidence</em></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="modelos-de-regresión-espacial.html"><a href="modelos-de-regresión-espacial.html"><i class="fa fa-check"></i><b>4</b> Modelos de regresión espacial</a>
<ul>
<li class="chapter" data-level="4.1" data-path="modelos-de-regresión-espacial.html"><a href="modelos-de-regresión-espacial.html#estudio-de-mercadeo"><i class="fa fa-check"></i><b>4.1</b> Estudio de Mercadeo</a></li>
<li class="chapter" data-level="4.2" data-path="modelos-de-regresión-espacial.html"><a href="modelos-de-regresión-espacial.html#paquetes"><i class="fa fa-check"></i><b>4.2</b> Paquetes</a></li>
<li class="chapter" data-level="4.3" data-path="modelos-de-regresión-espacial.html"><a href="modelos-de-regresión-espacial.html#lectura-de-datos"><i class="fa fa-check"></i><b>4.3</b> Lectura de Datos</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="modelos-de-regresión-espacial.html"><a href="modelos-de-regresión-espacial.html#cruce-de-información-y-arreglo-de-coordenadas"><i class="fa fa-check"></i><b>4.3.1</b> Cruce de información y arreglo de coordenadas</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="pre-procesamiento-de-datos.html"><a href="pre-procesamiento-de-datos.html"><i class="fa fa-check"></i><b>5</b> Pre-procesamiento de datos</a>
<ul>
<li class="chapter" data-level="5.1" data-path="pre-procesamiento-de-datos.html"><a href="pre-procesamiento-de-datos.html#matriz-de-vecindades"><i class="fa fa-check"></i><b>5.1</b> Matriz de vecindades</a></li>
<li class="chapter" data-level="5.2" data-path="pre-procesamiento-de-datos.html"><a href="pre-procesamiento-de-datos.html#mapa-de-valores-observados"><i class="fa fa-check"></i><b>5.2</b> Mapa de valores observados</a></li>
<li class="chapter" data-level="5.3" data-path="pre-procesamiento-de-datos.html"><a href="pre-procesamiento-de-datos.html#pruebas-de-autocorrelación"><i class="fa fa-check"></i><b>5.3</b> Pruebas de Autocorrelación</a></li>
<li class="chapter" data-level="5.4" data-path="pre-procesamiento-de-datos.html"><a href="pre-procesamiento-de-datos.html#mapas"><i class="fa fa-check"></i><b>5.4</b> Mapas</a></li>
<li class="chapter" data-level="5.5" data-path="pre-procesamiento-de-datos.html"><a href="pre-procesamiento-de-datos.html#resumen-de-modelos"><i class="fa fa-check"></i><b>5.5</b> Resumen de modelos</a></li>
<li class="chapter" data-level="5.6" data-path="pre-procesamiento-de-datos.html"><a href="pre-procesamiento-de-datos.html#calculo-de-varibles-significativas"><i class="fa fa-check"></i><b>5.6</b> Calculo de varibles significativas</a></li>
<li class="chapter" data-level="5.7" data-path="pre-procesamiento-de-datos.html"><a href="pre-procesamiento-de-datos.html#mapa-estimado"><i class="fa fa-check"></i><b>5.7</b> Mapa Estimado</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ilustración-del-kriging-simple-espacio-tiempo.html"><a href="ilustración-del-kriging-simple-espacio-tiempo.html"><i class="fa fa-check"></i><b>6</b> Ilustración del kriging simple espacio tiempo</a>
<ul>
<li class="chapter" data-level="6.1" data-path="ilustración-del-kriging-simple-espacio-tiempo.html"><a href="ilustración-del-kriging-simple-espacio-tiempo.html#librerías"><i class="fa fa-check"></i><b>6.1</b> librerías</a></li>
<li class="chapter" data-level="6.2" data-path="ilustración-del-kriging-simple-espacio-tiempo.html"><a href="ilustración-del-kriging-simple-espacio-tiempo.html#simulación-no-condicional-de-una-realización-de-un-campo-aleatorio-espacio-temporal-no-separable-usando-el-modelo-de-covarianza-cressie1"><i class="fa fa-check"></i><b>6.2</b> <strong>Simulación no condicional de una realización de un campo aleatorio espacio temporal no separable usando el modelo de covarianza cressie1</strong></a></li>
<li class="chapter" data-level="6.3" data-path="ilustración-del-kriging-simple-espacio-tiempo.html"><a href="ilustración-del-kriging-simple-espacio-tiempo.html#algunas-funciones-de-covarianza-espacio-temporal-no-separables"><i class="fa fa-check"></i><b>6.3</b> <strong>Algunas funciones de covarianza espacio temporal no separables</strong></a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="ilustración-del-kriging-simple-espacio-tiempo.html"><a href="ilustración-del-kriging-simple-espacio-tiempo.html#c-r-e-s-s-i-e---h-u-a-n-g-1999"><i class="fa fa-check"></i><b>6.3.1</b> C R E S S I E - H U A N G (1999)</a></li>
<li class="chapter" data-level="6.3.2" data-path="ilustración-del-kriging-simple-espacio-tiempo.html"><a href="ilustración-del-kriging-simple-espacio-tiempo.html#gneiting-2002-combina-fun1-fun2-y-psi-en-gneiting"><i class="fa fa-check"></i><b>6.3.2</b> Gneiting (2002), combina fun1, fun2 y psi en Gneiting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="pulimiento-de-medianas.html"><a href="pulimiento-de-medianas.html"><i class="fa fa-check"></i><b>7</b> Pulimiento de medianas</a>
<ul>
<li class="chapter" data-level="7.1" data-path="pulimiento-de-medianas.html"><a href="pulimiento-de-medianas.html#cargar-librerias"><i class="fa fa-check"></i><b>7.1</b> Cargar librerias</a></li>
<li class="chapter" data-level="7.2" data-path="pulimiento-de-medianas.html"><a href="pulimiento-de-medianas.html#grilla-de-las-ubicaciones-espaciales."><i class="fa fa-check"></i><b>7.2</b> Grilla de las ubicaciones espaciales.</a></li>
<li class="chapter" data-level="7.3" data-path="pulimiento-de-medianas.html"><a href="pulimiento-de-medianas.html#definición-de-objeto-vgm"><i class="fa fa-check"></i><b>7.3</b> Definición de objeto VGM</a></li>
<li class="chapter" data-level="7.4" data-path="pulimiento-de-medianas.html"><a href="pulimiento-de-medianas.html#matriz-de-varianza-dadas-coordenadas."><i class="fa fa-check"></i><b>7.4</b> Matriz de varianza dadas coordenadas.</a></li>
<li class="chapter" data-level="7.5" data-path="pulimiento-de-medianas.html"><a href="pulimiento-de-medianas.html#simulación."><i class="fa fa-check"></i><b>7.5</b> Simulación.</a></li>
<li class="chapter" data-level="7.6" data-path="pulimiento-de-medianas.html"><a href="pulimiento-de-medianas.html#pulimiento-de-medianas-1"><i class="fa fa-check"></i><b>7.6</b> Pulimiento de medianas</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="introducción-proceso-espacial-bivariado.html"><a href="introducción-proceso-espacial-bivariado.html"><i class="fa fa-check"></i><b>8</b> Introducción proceso espacial bivariado</a>
<ul>
<li class="chapter" data-level="8.1" data-path="introducción-proceso-espacial-bivariado.html"><a href="introducción-proceso-espacial-bivariado.html#librerías-1"><i class="fa fa-check"></i><b>8.1</b> Librerías</a></li>
<li class="chapter" data-level="8.2" data-path="introducción-proceso-espacial-bivariado.html"><a href="introducción-proceso-espacial-bivariado.html#ubicaciones-en-este-caso-se-supone-que-ambos-procesos-están-observados-en-los-mismos-lugares"><i class="fa fa-check"></i><b>8.2</b> Ubicaciones: En este caso se supone que ambos procesos están observados en los mismos lugares</a></li>
<li class="chapter" data-level="8.3" data-path="introducción-proceso-espacial-bivariado.html"><a href="introducción-proceso-espacial-bivariado.html#modelo-lineal-de-coregionalización"><i class="fa fa-check"></i><b>8.3</b> Modelo lineal de coregionalización</a></li>
<li class="chapter" data-level="8.4" data-path="introducción-proceso-espacial-bivariado.html"><a href="introducción-proceso-espacial-bivariado.html#simulación-de-un-proceso-espacial-gaussiano-bivariado"><i class="fa fa-check"></i><b>8.4</b> Simulación de un proceso espacial Gaussiano bivariado</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="geoestadística-con-sgeostat.html"><a href="geoestadística-con-sgeostat.html"><i class="fa fa-check"></i><b>9</b> Geoestadística con sgeostat</a>
<ul>
<li class="chapter" data-level="9.1" data-path="geoestadística-con-sgeostat.html"><a href="geoestadística-con-sgeostat.html#data-load"><i class="fa fa-check"></i><b>9.1</b> Data Load</a></li>
<li class="chapter" data-level="9.2" data-path="geoestadística-con-sgeostat.html"><a href="geoestadística-con-sgeostat.html#libraries"><i class="fa fa-check"></i><b>9.2</b> Libraries</a></li>
<li class="chapter" data-level="9.3" data-path="geoestadística-con-sgeostat.html"><a href="geoestadística-con-sgeostat.html#including-plots"><i class="fa fa-check"></i><b>9.3</b> Including Plots</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="cokriging.html"><a href="cokriging.html"><i class="fa fa-check"></i><b>10</b> Cokriging</a>
<ul>
<li class="chapter" data-level="10.1" data-path="cokriging.html"><a href="cokriging.html#librerías-2"><i class="fa fa-check"></i><b>10.1</b> Librerías</a></li>
<li class="chapter" data-level="10.2" data-path="cokriging.html"><a href="cokriging.html#descripción-de-los-datos"><i class="fa fa-check"></i><b>10.2</b> Descripción de los datos</a></li>
<li class="chapter" data-level="10.3" data-path="cokriging.html"><a href="cokriging.html#matrices-de-coregionalización."><i class="fa fa-check"></i><b>10.3</b> Matrices de coregionalización.</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="cokriging.html"><a href="cokriging.html#matriz-definida-positiva-para-el-modelo-esférico."><i class="fa fa-check"></i><b>10.3.1</b> Matriz definida positiva para el modelo Esférico.</a></li>
<li class="chapter" data-level="10.3.2" data-path="cokriging.html"><a href="cokriging.html#matriz-definida-positiva-para-el-modelo-efecto-hueco."><i class="fa fa-check"></i><b>10.3.2</b> Matriz definida positiva para el modelo efecto Hueco.</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="cokriging.html"><a href="cokriging.html#definición-de-objeto-en-gstat"><i class="fa fa-check"></i><b>10.4</b> Definición de objeto en gstat</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="cokriging.html"><a href="cokriging.html#semivariogramas-univariados"><i class="fa fa-check"></i><b>10.4.1</b> Semivariogramas univariados</a></li>
<li class="chapter" data-level="10.4.2" data-path="cokriging.html"><a href="cokriging.html#semivarogramas-cruzados-bivariados"><i class="fa fa-check"></i><b>10.4.2</b> Semivarogramas cruzados (Bivariados)</a></li>
<li class="chapter" data-level="10.4.3" data-path="cokriging.html"><a href="cokriging.html#gstat"><i class="fa fa-check"></i><b>10.4.3</b> gstat</a></li>
<li class="chapter" data-level="10.4.4" data-path="cokriging.html"><a href="cokriging.html#estimación-del-semivariograma"><i class="fa fa-check"></i><b>10.4.4</b> Estimación del semivariograma</a></li>
<li class="chapter" data-level="10.4.5" data-path="cokriging.html"><a href="cokriging.html#mapas-de-predicción-de-o3-con-las-covariables-espaciales-no2-y-nox"><i class="fa fa-check"></i><b>10.4.5</b> Mapas de predicción de O3 con las covariables espaciales NO2 y NOX</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="introducción-al-proceso-espacial-bivariado.html"><a href="introducción-al-proceso-espacial-bivariado.html"><i class="fa fa-check"></i><b>11</b> Introducción al proceso espacial bivariado</a>
<ul>
<li class="chapter" data-level="11.1" data-path="introducción-al-proceso-espacial-bivariado.html"><a href="introducción-al-proceso-espacial-bivariado.html#dependencias"><i class="fa fa-check"></i><b>11.1</b> Dependencias</a></li>
<li class="chapter" data-level="11.2" data-path="introducción-al-proceso-espacial-bivariado.html"><a href="introducción-al-proceso-espacial-bivariado.html#ubicaciones"><i class="fa fa-check"></i><b>11.2</b> Ubicaciones:</a></li>
<li class="chapter" data-level="11.3" data-path="introducción-al-proceso-espacial-bivariado.html"><a href="introducción-al-proceso-espacial-bivariado.html#modelo-lineal-de-coregionalización-1"><i class="fa fa-check"></i><b>11.3</b> Modelo lineal de coregionalización</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="introducción-al-proceso-espacial-bivariado.html"><a href="introducción-al-proceso-espacial-bivariado.html#determinante-de-la-matriz-de-covarianzas"><i class="fa fa-check"></i><b>11.3.1</b> Determinante de la matriz de covarianzas</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="introducción-al-proceso-espacial-bivariado.html"><a href="introducción-al-proceso-espacial-bivariado.html#simulación-de-un-proceso-espacial-gaussiano-bivariado-1"><i class="fa fa-check"></i><b>11.4</b> simulación de un proceso espacial Gaussiano bivariado</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ilustración-del-kriging-simple-espacio-tiempo-1.html"><a href="ilustración-del-kriging-simple-espacio-tiempo-1.html"><i class="fa fa-check"></i><b>12</b> Ilustración del kriging simple espacio tiempo</a>
<ul>
<li class="chapter" data-level="12.1" data-path="ilustración-del-kriging-simple-espacio-tiempo-1.html"><a href="ilustración-del-kriging-simple-espacio-tiempo-1.html#dependencias-1"><i class="fa fa-check"></i><b>12.1</b> Dependencias</a></li>
<li class="chapter" data-level="12.2" data-path="ilustración-del-kriging-simple-espacio-tiempo-1.html"><a href="ilustración-del-kriging-simple-espacio-tiempo-1.html#simulación-no-condicional-de-una-realización-de-un-campo-aleatorio-espacio-temporal-no-separable-usando-el-modelo-de-covarianza-cressie1-1"><i class="fa fa-check"></i><b>12.2</b> Simulación no condicional de una realización de un campo aleatorio espacio temporal no separable usando el modelo de covarianza cressie1</a></li>
<li class="chapter" data-level="12.3" data-path="ilustración-del-kriging-simple-espacio-tiempo-1.html"><a href="ilustración-del-kriging-simple-espacio-tiempo-1.html#algunas-funciones-de-covarianza-espacio-temporal-no-separables-1"><i class="fa fa-check"></i><b>12.3</b> Algunas funciones de covarianza espacio temporal no separables</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="ilustración-del-kriging-simple-espacio-tiempo-1.html"><a href="ilustración-del-kriging-simple-espacio-tiempo-1.html#c-r-e-s-s-i-e---h-u-a-n-g-1999-1"><i class="fa fa-check"></i><b>12.3.1</b> C R E S S I E - H U A N G (1999)</a></li>
<li class="chapter" data-level="12.3.2" data-path="ilustración-del-kriging-simple-espacio-tiempo-1.html"><a href="ilustración-del-kriging-simple-espacio-tiempo-1.html#gneiting-2002-combina-fun1-fun2-y-psi-en-gneiting-1"><i class="fa fa-check"></i><b>12.3.2</b> Gneiting (2002), combina fun1, fun2 y psi en Gneiting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html"><i class="fa fa-check"></i><b>13</b> Análisis de datos funcionales</a>
<ul>
<li class="chapter" data-level="13.1" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#análisis-de-datos-funcionales-adf---análisis-exploratorio"><i class="fa fa-check"></i><b>13.1</b> Análisis de datos funcionales (ADF) - Análisis exploratorio</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#datos-funcionales"><i class="fa fa-check"></i><b>13.1.1</b> Datos funcionales</a></li>
<li class="chapter" data-level="13.1.2" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#análisis-gráfico-y-detección-de-outliers"><i class="fa fa-check"></i><b>13.1.2</b> Análisis gráfico y detección de outliers</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#análisis-de-datos-funcionales-adf---análisis-gráfico"><i class="fa fa-check"></i><b>13.2</b> Análisis de datos funcionales (ADF) - Análisis gráfico</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#deteccción-de-curvas-atípicas"><i class="fa fa-check"></i><b>13.2.1</b> Deteccción de curvas atípicas</a></li>
<li class="chapter" data-level="13.2.2" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#otras-medidas-de-resumen"><i class="fa fa-check"></i><b>13.2.2</b> Otras medidas de resumen</a></li>
<li class="chapter" data-level="13.2.3" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#análisis-en-componentes-principales-acpf"><i class="fa fa-check"></i><b>13.2.3</b> Análisis en Componentes Principales (ACPF)</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#modelos-lineales"><i class="fa fa-check"></i><b>13.3</b> Modelos lineales</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#regresión-lineal-funcional-con-respuesta-escalar"><i class="fa fa-check"></i><b>13.3.1</b> Regresión lineal funcional con respuesta escalar</a></li>
<li class="chapter" data-level="13.3.2" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#estimación-de-los-coeficientes-beta-con-regularización"><i class="fa fa-check"></i><b>13.3.2</b> Estimación de los coeficientes <span class="math inline">\(\beta\)</span> con regularización</a></li>
<li class="chapter" data-level="13.3.3" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#prueba-f-para-ajuste-del-modelo-a-través-de-permutaciones"><i class="fa fa-check"></i><b>13.3.3</b> Prueba <span class="math inline">\(F\)</span> para ajuste del modelo a través de permutaciones</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#modelos-lineales-funcionales-regresión-funcional"><i class="fa fa-check"></i><b>13.4</b> Modelos lineales funcionales (Regresión Funcional)</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#regresión-lineal-funcional-con-respuesta-funcional-anova-funcional"><i class="fa fa-check"></i><b>13.4.1</b> Regresión lineal funcional con respuesta funcional (ANOVA Funcional)</a></li>
<li class="chapter" data-level="13.4.2" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#estimación---mínimos-cuadrados-ordinarios"><i class="fa fa-check"></i><b>13.4.2</b> Estimación - Mínimos cuadrados ordinarios</a></li>
<li class="chapter" data-level="13.4.3" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#pruebas-de-hipótesis---prueba-de-shen-faraway"><i class="fa fa-check"></i><b>13.4.3</b> Pruebas de hipótesis - Prueba de Shen &amp; Faraway</a></li>
<li class="chapter" data-level="13.4.4" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#ejemplo"><i class="fa fa-check"></i><b>13.4.4</b> Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#estadística-espacial"><i class="fa fa-check"></i><b>13.5</b> Estadística Espacial</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#metodología-de-predicción-espacial-con-datos-funcionales"><i class="fa fa-check"></i><b>13.5.1</b> Metodología de predicción espacial con datos funcionales</a></li>
<li class="chapter" data-level="13.5.2" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#ilustración"><i class="fa fa-check"></i><b>13.5.2</b> Ilustración</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#patrones-puntuales"><i class="fa fa-check"></i><b>13.6</b> Patrones Puntuales</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="análisis-de-datos-funcionales.html"><a href="análisis-de-datos-funcionales.html#datos"><i class="fa fa-check"></i><b>13.6.1</b> Datos</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Patrones Puntuales</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="spatial-modeling-leukemia" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Spatial modeling leukemia<a href="spatial-modeling-leukemia.html#spatial-modeling-leukemia" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="mortality" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> <strong>Mortality</strong><a href="spatial-modeling-leukemia.html#mortality" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Spatial modeling of incidence and mortality childhood leukemia based on Colombian armed conflict and poverty for children born during the years 2002-2013</p>
<div id="packages-mortality" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> <em>Packages Mortality</em><a href="spatial-modeling-leukemia.html#packages-mortality" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="spatial-modeling-leukemia.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb29-2"><a href="spatial-modeling-leukemia.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(rgdal)</span>
<span id="cb29-3"><a href="spatial-modeling-leukemia.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(pscl)</span>
<span id="cb29-4"><a href="spatial-modeling-leukemia.html#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(sf)</span>
<span id="cb29-5"><a href="spatial-modeling-leukemia.html#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(spdep)</span>
<span id="cb29-6"><a href="spatial-modeling-leukemia.html#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(spatialreg) <span class="co">#test.W, scores.listw</span></span>
<span id="cb29-7"><a href="spatial-modeling-leukemia.html#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(stringr)</span>
<span id="cb29-8"><a href="spatial-modeling-leukemia.html#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(performance)</span>
<span id="cb29-9"><a href="spatial-modeling-leukemia.html#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(AER)</span>
<span id="cb29-10"><a href="spatial-modeling-leukemia.html#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggplot2)</span>
<span id="cb29-11"><a href="spatial-modeling-leukemia.html#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vcdExtra)</span>
<span id="cb29-12"><a href="spatial-modeling-leukemia.html#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(dbscan)</span></code></pre></div>
</div>
<div id="code-mortality" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> <em>Code Mortality</em><a href="spatial-modeling-leukemia.html#code-mortality" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><strong>Reading the shapefile of 1124 Colombian municipalities, defining the Coordinate Reference System and centroid and building some variables</strong></li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="spatial-modeling-leukemia.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Reading the shapefile of 1124 Colombian municipalities</span></span>
<span id="cb30-2"><a href="spatial-modeling-leukemia.html#cb30-2" aria-hidden="true" tabindex="-1"></a>muncol <span class="ot">&lt;-</span> rgdal<span class="sc">::</span><span class="fu">readOGR</span>(<span class="at">dsn=</span><span class="st">&quot;Armed_Conflict_Vs_Leukemia/muncol.shp&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
<pre><code>## Warning: OGR support is provided by the sf and terra packages among others</code></pre>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;/home/jncc/Documents/Monitorias/EspacialPage/Clases-EE-UN/Armed_Conflict_Vs_Leukemia/muncol.shp&quot;, layer: &quot;muncol&quot;
## with 1124 features
## It has 17 fields</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="spatial-modeling-leukemia.html#cb39-1" aria-hidden="true" tabindex="-1"></a>muncol<span class="ot">=</span><span class="fu">spTransform</span>(muncol,<span class="fu">CRS</span>(<span class="st">&quot;+init=epsg:21897&quot;</span>))</span></code></pre></div>
<pre><code>## Warning: PROJ support is provided by the sf and terra packages among others</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="spatial-modeling-leukemia.html#cb41-1" aria-hidden="true" tabindex="-1"></a>(l <span class="ot">&lt;-</span> <span class="fu">length</span>(muncol))</span></code></pre></div>
<pre><code>## [1] 1124</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="spatial-modeling-leukemia.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Representative coordinate (centroid)</span></span>
<span id="cb43-2"><a href="spatial-modeling-leukemia.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">warn =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb43-3"><a href="spatial-modeling-leukemia.html#cb43-3" aria-hidden="true" tabindex="-1"></a>xy0<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">x=</span>muncol<span class="sc">$</span>x,<span class="at">y=</span>muncol<span class="sc">$</span>y)</span>
<span id="cb43-4"><a href="spatial-modeling-leukemia.html#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(xy0) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;x&#39;</span>,<span class="st">&#39;y&#39;</span>)</span>
<span id="cb43-5"><a href="spatial-modeling-leukemia.html#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">proj4string</span>(xy0) <span class="ot">&lt;-</span> <span class="fu">CRS</span>(<span class="st">&quot;+init=epsg:4326&quot;</span>)</span>
<span id="cb43-6"><a href="spatial-modeling-leukemia.html#cb43-6" aria-hidden="true" tabindex="-1"></a>xy0<span class="ot">=</span><span class="fu">spTransform</span>(xy0,<span class="fu">CRS</span>(<span class="st">&quot;+init=epsg:21897&quot;</span>))</span>
<span id="cb43-7"><a href="spatial-modeling-leukemia.html#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="spatial-modeling-leukemia.html#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="do">###Loops for avoiding NA </span></span>
<span id="cb43-9"><a href="spatial-modeling-leukemia.html#cb43-9" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">sum</span>(muncol<span class="sc">$</span>Ndeaths)<span class="sc">/</span><span class="fu">sum</span>(muncol<span class="sc">$</span>NPop)</span>
<span id="cb43-10"><a href="spatial-modeling-leukemia.html#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>l){ </span>
<span id="cb43-11"><a href="spatial-modeling-leukemia.html#cb43-11" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span>(muncol<span class="sc">$</span>NPop[i]<span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb43-12"><a href="spatial-modeling-leukemia.html#cb43-12" aria-hidden="true" tabindex="-1"></a>      muncol<span class="sc">$</span>EsperadosDeNCancer[i] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb43-13"><a href="spatial-modeling-leukemia.html#cb43-13" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb43-14"><a href="spatial-modeling-leukemia.html#cb43-14" aria-hidden="true" tabindex="-1"></a>   <span class="cf">else</span>{</span>
<span id="cb43-15"><a href="spatial-modeling-leukemia.html#cb43-15" aria-hidden="true" tabindex="-1"></a>      muncol<span class="sc">$</span>EsperadosDeNCancer[i] <span class="ot">&lt;-</span> muncol<span class="sc">$</span>NPop[i]<span class="sc">*</span>r</span>
<span id="cb43-16"><a href="spatial-modeling-leukemia.html#cb43-16" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb43-17"><a href="spatial-modeling-leukemia.html#cb43-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-18"><a href="spatial-modeling-leukemia.html#cb43-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-19"><a href="spatial-modeling-leukemia.html#cb43-19" aria-hidden="true" tabindex="-1"></a>muncol<span class="sc">$</span>IICA_Cat<span class="ot">=</span>muncol<span class="sc">$</span>IICA_Ca</span>
<span id="cb43-20"><a href="spatial-modeling-leukemia.html#cb43-20" aria-hidden="true" tabindex="-1"></a>muncol<span class="sc">$</span>IICA_Cat<span class="ot">=</span><span class="fu">str_replace_all</span>(muncol<span class="sc">$</span>IICA_Cat,<span class="st">&quot;Bajo&quot;</span>, <span class="st">&quot;Low&quot;</span>)</span>
<span id="cb43-21"><a href="spatial-modeling-leukemia.html#cb43-21" aria-hidden="true" tabindex="-1"></a>muncol<span class="sc">$</span>IICA_Cat<span class="ot">=</span><span class="fu">str_replace_all</span>(muncol<span class="sc">$</span>IICA_Cat,<span class="st">&quot;Medio&quot;</span>, <span class="st">&quot;Medium&quot;</span>)</span>
<span id="cb43-22"><a href="spatial-modeling-leukemia.html#cb43-22" aria-hidden="true" tabindex="-1"></a>muncol<span class="sc">$</span>IICA_CatLow<span class="ot">=</span><span class="fu">ifelse</span>(muncol<span class="sc">$</span>IICA_Cat<span class="sc">==</span><span class="st">&quot;Low&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb43-23"><a href="spatial-modeling-leukemia.html#cb43-23" aria-hidden="true" tabindex="-1"></a>muncol<span class="sc">$</span>IICA_CatMed<span class="ot">=</span><span class="fu">ifelse</span>(muncol<span class="sc">$</span>IICA_Cat<span class="sc">==</span><span class="st">&quot;Medium&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb43-24"><a href="spatial-modeling-leukemia.html#cb43-24" aria-hidden="true" tabindex="-1"></a>muncol<span class="sc">$</span>IICA_High<span class="ot">=</span><span class="fu">as.character</span>(<span class="dv">1</span><span class="sc">-</span>(muncol<span class="sc">$</span>IICA_CatLow<span class="sc">+</span>muncol<span class="sc">$</span>IICA_CatMed))</span>
<span id="cb43-25"><a href="spatial-modeling-leukemia.html#cb43-25" aria-hidden="true" tabindex="-1"></a>muncol<span class="sc">$</span>UBN<span class="ot">=</span>muncol<span class="sc">$</span>NBI</span></code></pre></div>
<ul>
<li><strong>Modeling leukemia Mortality Rate (LR) in terms of Colombian armed conflict index, poverty, rurality and health coverage. First, the usual Poisson regression model with mortality rate as response variable is estimated.</strong></li>
</ul>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="spatial-modeling-leukemia.html#cb44-1" aria-hidden="true" tabindex="-1"></a>glmbaseLMR<span class="ot">&lt;-</span><span class="fu">glm</span>(Ndeaths <span class="sc">~</span>IICA_High<span class="sc">+</span>UBN<span class="sc">+</span>Per_Rur<span class="sc">+</span>Cobertura<span class="sc">+</span><span class="fu">offset</span>(<span class="fu">log</span>(EsperadosDeNCancer)), <span class="at">family =</span> poisson,<span class="at">data =</span> muncol)</span>
<span id="cb44-2"><a href="spatial-modeling-leukemia.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(glmbaseLMR)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model: poisson, link: log
## 
## Response: Ndeaths
## 
## Terms added sequentially (first to last)
## 
## 
##           Df Deviance Resid. Df Resid. Dev
## NULL                       1123     799.92
## IICA_High  1    0.694      1122     799.22
## UBN        1   43.405      1121     755.82
## Per_Rur    1    4.017      1120     751.80
## Cobertura  1    9.185      1119     742.62</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="spatial-modeling-leukemia.html#cb46-1" aria-hidden="true" tabindex="-1"></a>muncol<span class="sc">$</span>residLMR<span class="ot">=</span><span class="fu">residuals</span>(glmbaseLMR)</span>
<span id="cb46-2"><a href="spatial-modeling-leukemia.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glmbaseLMR)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Ndeaths ~ IICA_High + UBN + Per_Rur + Cobertura + 
##     offset(log(EsperadosDeNCancer)), family = poisson, data = muncol)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.9317  -0.5949  -0.4108  -0.2389   3.3300  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept) -0.583783   0.307508  -1.898  0.05764 . 
## IICA_High1   0.107822   0.084777   1.272  0.20343   
## UBN         -0.007902   0.003003  -2.632  0.00850 **
## Per_Rur     -0.002705   0.002370  -1.141  0.25380   
## Cobertura    0.991687   0.336039   2.951  0.00317 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 799.92  on 1123  degrees of freedom
## Residual deviance: 742.62  on 1119  degrees of freedom
## AIC: 1271.7
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<ul>
<li><p><strong><em>Rurality and conflict armed index are not statistically significant in this first auxiliar model. However, we maintain these variables in the rest of the analysis and review its significance in the final model.</em></strong></p></li>
<li><p><strong><em>Checking excess zeros by comparison between the number of zeros predicted by the model with the observed number of zeros. Also checking overdispersion.</em></strong></p></li>
</ul>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="spatial-modeling-leukemia.html#cb48-1" aria-hidden="true" tabindex="-1"></a>mu_LMR <span class="ot">&lt;-</span> <span class="fu">predict</span>(glmbaseLMR, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)  <span class="co"># predict expected mean count</span></span>
<span id="cb48-2"><a href="spatial-modeling-leukemia.html#cb48-2" aria-hidden="true" tabindex="-1"></a>expLMR <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">dpois</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">lambda =</span> mu_LMR))      <span class="co"># sum the probabilities of a zero count for each mean</span></span>
<span id="cb48-3"><a href="spatial-modeling-leukemia.html#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(expLMR)                                    <span class="co">#predicted number of zeros</span></span></code></pre></div>
<pre><code>## [1] 898</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="spatial-modeling-leukemia.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(muncol<span class="sc">$</span>Ndeaths <span class="sc">&lt;</span> <span class="dv">1</span>)                          <span class="co">#observed number of zeros</span></span></code></pre></div>
<pre><code>## [1] 907</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="spatial-modeling-leukemia.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">zero.test</span>(muncol<span class="sc">$</span>Ndeaths)                        <span class="co">#score test (van den Broek, 1995)</span></span></code></pre></div>
<pre><code>## Score test for zero inflation
## 
##      Chi-square = 902.95398 
##      df = 1
##      pvalue: &lt; 2.22e-16</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="spatial-modeling-leukemia.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="do">##Checking overdispersion</span></span>
<span id="cb54-2"><a href="spatial-modeling-leukemia.html#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dispersiontest</span>(glmbaseLMR)             <span class="co">#Cameron &amp; Trivedi (1990)</span></span></code></pre></div>
<pre><code>## 
##  Overdispersion test
## 
## data:  glmbaseLMR
## z = 2.2049, p-value = 0.01373
## alternative hypothesis: true dispersion is greater than 1
## sample estimates:
## dispersion 
##   1.109361</code></pre>
<ul>
<li><p><strong><em>The observed frequency of zeroes in data exceeds the predicted in the Leukemia mortality rate (LMR) model. Also, overdispersion is detected.</em></strong></p></li>
<li><p><strong><em>Now, to validate the independence assumption, first, it is necessary to define spatial weighting possible matrices.</em></strong></p></li>
</ul>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="spatial-modeling-leukemia.html#cb56-1" aria-hidden="true" tabindex="-1"></a>rook_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">poly2nb</span>(muncol,<span class="at">queen=</span><span class="cn">FALSE</span>), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-2"><a href="spatial-modeling-leukemia.html#cb56-2" aria-hidden="true" tabindex="-1"></a>rook_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">poly2nb</span>(muncol,<span class="at">queen=</span><span class="cn">FALSE</span>), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-3"><a href="spatial-modeling-leukemia.html#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="spatial-modeling-leukemia.html#cb56-4" aria-hidden="true" tabindex="-1"></a>queen_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">poly2nb</span>(muncol,<span class="at">queen=</span><span class="cn">TRUE</span>), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-5"><a href="spatial-modeling-leukemia.html#cb56-5" aria-hidden="true" tabindex="-1"></a>queen_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">poly2nb</span>(muncol,<span class="at">queen=</span><span class="cn">TRUE</span>), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-6"><a href="spatial-modeling-leukemia.html#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="spatial-modeling-leukemia.html#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Graphs neighbours</span></span>
<span id="cb56-8"><a href="spatial-modeling-leukemia.html#cb56-8" aria-hidden="true" tabindex="-1"></a>trinb<span class="ot">=</span><span class="fu">tri2nb</span>(xy0)</span>
<span id="cb56-9"><a href="spatial-modeling-leukemia.html#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">warn =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb56-10"><a href="spatial-modeling-leukemia.html#cb56-10" aria-hidden="true" tabindex="-1"></a>tri_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">tri2nb</span>(xy0), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-11"><a href="spatial-modeling-leukemia.html#cb56-11" aria-hidden="true" tabindex="-1"></a>tri_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">tri2nb</span>(xy0), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-12"><a href="spatial-modeling-leukemia.html#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="spatial-modeling-leukemia.html#cb56-13" aria-hidden="true" tabindex="-1"></a>soi_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">graph2nb</span>(<span class="fu">soi.graph</span>(trinb,xy0)), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-14"><a href="spatial-modeling-leukemia.html#cb56-14" aria-hidden="true" tabindex="-1"></a>soi_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">graph2nb</span>(<span class="fu">soi.graph</span>(trinb,xy0)), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-15"><a href="spatial-modeling-leukemia.html#cb56-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-16"><a href="spatial-modeling-leukemia.html#cb56-16" aria-hidden="true" tabindex="-1"></a>relative_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">graph2nb</span>(<span class="fu">relativeneigh</span>(xy0), <span class="at">sym=</span><span class="cn">TRUE</span>), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-17"><a href="spatial-modeling-leukemia.html#cb56-17" aria-hidden="true" tabindex="-1"></a>relative_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">graph2nb</span>(<span class="fu">relativeneigh</span>(xy0), <span class="at">sym=</span><span class="cn">TRUE</span>), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-18"><a href="spatial-modeling-leukemia.html#cb56-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-19"><a href="spatial-modeling-leukemia.html#cb56-19" aria-hidden="true" tabindex="-1"></a>gabriel_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">graph2nb</span>(<span class="fu">gabrielneigh</span>(xy0), <span class="at">sym=</span><span class="cn">TRUE</span>), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-20"><a href="spatial-modeling-leukemia.html#cb56-20" aria-hidden="true" tabindex="-1"></a>gabriel_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">graph2nb</span>(<span class="fu">gabrielneigh</span>(xy0), <span class="at">sym=</span><span class="cn">TRUE</span>), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-21"><a href="spatial-modeling-leukemia.html#cb56-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-22"><a href="spatial-modeling-leukemia.html#cb56-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Distance neighbours</span></span>
<span id="cb56-23"><a href="spatial-modeling-leukemia.html#cb56-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-24"><a href="spatial-modeling-leukemia.html#cb56-24" aria-hidden="true" tabindex="-1"></a>knn1_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(xy0, <span class="at">k =</span> <span class="dv">1</span>)), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-25"><a href="spatial-modeling-leukemia.html#cb56-25" aria-hidden="true" tabindex="-1"></a>knn1_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(xy0, <span class="at">k =</span> <span class="dv">1</span>)), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-26"><a href="spatial-modeling-leukemia.html#cb56-26" aria-hidden="true" tabindex="-1"></a>knn2_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(xy0, <span class="at">k =</span> <span class="dv">2</span>)), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-27"><a href="spatial-modeling-leukemia.html#cb56-27" aria-hidden="true" tabindex="-1"></a>knn2_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(xy0, <span class="at">k =</span> <span class="dv">2</span>)), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-28"><a href="spatial-modeling-leukemia.html#cb56-28" aria-hidden="true" tabindex="-1"></a>knn3_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(xy0, <span class="at">k =</span> <span class="dv">3</span>)), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-29"><a href="spatial-modeling-leukemia.html#cb56-29" aria-hidden="true" tabindex="-1"></a>knn3_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(xy0, <span class="at">k =</span> <span class="dv">3</span>)), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-30"><a href="spatial-modeling-leukemia.html#cb56-30" aria-hidden="true" tabindex="-1"></a>knn4_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(xy0, <span class="at">k =</span> <span class="dv">4</span>)), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-31"><a href="spatial-modeling-leukemia.html#cb56-31" aria-hidden="true" tabindex="-1"></a>knn4_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(xy0, <span class="at">k =</span> <span class="dv">4</span>)), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-32"><a href="spatial-modeling-leukemia.html#cb56-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-33"><a href="spatial-modeling-leukemia.html#cb56-33" aria-hidden="true" tabindex="-1"></a>mat<span class="ot">=</span><span class="fu">list</span>(rook_nb_b,rook_nb_w,</span>
<span id="cb56-34"><a href="spatial-modeling-leukemia.html#cb56-34" aria-hidden="true" tabindex="-1"></a>         queen_nb_b,queen_nb_w,</span>
<span id="cb56-35"><a href="spatial-modeling-leukemia.html#cb56-35" aria-hidden="true" tabindex="-1"></a>         tri_nb_b,tri_nb_w,</span>
<span id="cb56-36"><a href="spatial-modeling-leukemia.html#cb56-36" aria-hidden="true" tabindex="-1"></a>         soi_nb_b,soi_nb_w,</span>
<span id="cb56-37"><a href="spatial-modeling-leukemia.html#cb56-37" aria-hidden="true" tabindex="-1"></a>         gabriel_nb_b,gabriel_nb_w,</span>
<span id="cb56-38"><a href="spatial-modeling-leukemia.html#cb56-38" aria-hidden="true" tabindex="-1"></a>         relative_nb_b,relative_nb_w,</span>
<span id="cb56-39"><a href="spatial-modeling-leukemia.html#cb56-39" aria-hidden="true" tabindex="-1"></a>         knn1_nb_b,knn1_nb_w,</span>
<span id="cb56-40"><a href="spatial-modeling-leukemia.html#cb56-40" aria-hidden="true" tabindex="-1"></a>         knn2_nb_b,knn2_nb_w,</span>
<span id="cb56-41"><a href="spatial-modeling-leukemia.html#cb56-41" aria-hidden="true" tabindex="-1"></a>         knn3_nb_b,knn3_nb_w,</span>
<span id="cb56-42"><a href="spatial-modeling-leukemia.html#cb56-42" aria-hidden="true" tabindex="-1"></a>         knn4_nb_b,knn4_nb_w)</span></code></pre></div>
<ul>
<li><strong><em>Testing spatial autocorrelation using Moran index test based on weighting matrices built in the last step. Note that with all weighting matrices we obtain a significant spatial autocorrelation.</em></strong></li>
</ul>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="spatial-modeling-leukemia.html#cb57-1" aria-hidden="true" tabindex="-1"></a>aux<span class="ot">=</span><span class="fu">numeric</span>(<span class="dv">0</span>)</span>
<span id="cb57-2"><a href="spatial-modeling-leukemia.html#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">warn =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb57-3"><a href="spatial-modeling-leukemia.html#cb57-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb57-4"><a href="spatial-modeling-leukemia.html#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mat))</span>
<span id="cb57-5"><a href="spatial-modeling-leukemia.html#cb57-5" aria-hidden="true" tabindex="-1"></a>aux[i]<span class="ot">=</span><span class="fu">moran.test</span>(muncol<span class="sc">$</span>residLMR,mat[[i]],<span class="at">alternative=</span><span class="st">&quot;two.sided&quot;</span>)<span class="sc">$</span><span class="st">&quot;statistic&quot;</span></span>
<span id="cb57-6"><a href="spatial-modeling-leukemia.html#cb57-6" aria-hidden="true" tabindex="-1"></a>aux</span>
<span id="cb57-7"><a href="spatial-modeling-leukemia.html#cb57-7" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<pre><code>##  [1] 1.238996 1.473832 1.428553 1.629968 1.367192 1.592464 1.921616 2.011106 1.860100 2.247294 2.629440 2.588622
## [13] 1.099401 1.099401 2.469062 2.469062 3.088200 3.088200 3.450986 3.450986</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="spatial-modeling-leukemia.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.max</span>(aux)</span></code></pre></div>
<pre><code>## [1] 19</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="spatial-modeling-leukemia.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(muncol<span class="sc">$</span>residLMR, mat[[<span class="fu">which.max</span>(aux)]], <span class="at">alternative=</span><span class="st">&quot;two.sided&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Moran I test under randomisation
## 
## data:  muncol$residLMR  
## weights: mat[[which.max(aux)]]    
## 
## Moran I statistic standard deviate = 3.451, p-value = 0.0005585
## alternative hypothesis: two.sided
## sample estimates:
## Moran I statistic       Expectation          Variance 
##      0.0672352967     -0.0008904720      0.0003897053</code></pre>
<ul>
<li><strong><em>First, Poisson Hurdle model is estimated without consider spatial autocorrelation.</em></strong></li>
</ul>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="spatial-modeling-leukemia.html#cb63-1" aria-hidden="true" tabindex="-1"></a>mod.hurdleLMR <span class="ot">&lt;-</span> <span class="fu">hurdle</span>(Ndeaths <span class="sc">~</span>IICA_High<span class="sc">+</span>UBN<span class="sc">+</span>Per_Rur<span class="sc">+</span>Cobertura<span class="sc">+</span><span class="fu">offset</span>(<span class="fu">log</span>(EsperadosDeNCancer))<span class="sc">|</span>IICA_High<span class="sc">+</span>UBN<span class="sc">+</span>Per_Rur<span class="sc">+</span>Cobertura<span class="sc">+</span><span class="fu">offset</span>(<span class="fu">log</span>(EsperadosDeNCancer)),<span class="at">data =</span> muncol,<span class="at">dist =</span> <span class="st">&quot;poisson&quot;</span>, <span class="at">zero.dist =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb63-2"><a href="spatial-modeling-leukemia.html#cb63-2" aria-hidden="true" tabindex="-1"></a>resid_Pois_Hurdle<span class="ot">=</span><span class="fu">residuals</span>(mod.hurdleLMR,<span class="st">&quot;response&quot;</span>)</span>
<span id="cb63-3"><a href="spatial-modeling-leukemia.html#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod.hurdleLMR)</span></code></pre></div>
<pre><code>## 
## Call:
## hurdle(formula = Ndeaths ~ IICA_High + UBN + Per_Rur + Cobertura + offset(log(EsperadosDeNCancer)) | 
##     IICA_High + UBN + Per_Rur + Cobertura + offset(log(EsperadosDeNCancer)), data = muncol, dist = &quot;poisson&quot;, 
##     zero.dist = &quot;binomial&quot;)
## 
## Pearson residuals:
##     Min      1Q  Median      3Q     Max 
## -1.6105 -0.4155 -0.2926 -0.1781  7.8519 
## 
## Count model coefficients (truncated poisson with log link):
##               Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)  0.0131708  0.3793725   0.035   0.9723  
## IICA_High1   0.2239159  0.1048208   2.136   0.0327 *
## UBN         -0.0006294  0.0050823  -0.124   0.9014  
## Per_Rur     -0.0064173  0.0049162  -1.305   0.1918  
## Cobertura    0.1702217  0.4227398   0.403   0.6872  
## Zero hurdle model coefficients (binomial with logit link):
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.013658   0.570592  -1.777 0.075650 .  
## IICA_High1  -0.091317   0.177363  -0.515 0.606652    
## UBN         -0.011792   0.004690  -2.514 0.011928 *  
## Per_Rur     -0.005190   0.003982  -1.303 0.192473    
## Cobertura    2.283308   0.624231   3.658 0.000254 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 
## 
## Number of iterations in BFGS optimization: 10 
## Log-likelihood:  -624 on 10 Df</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="spatial-modeling-leukemia.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pR2</span>(mod.hurdleLMR)</span></code></pre></div>
<pre><code>## fitting null model for pseudo-r2</code></pre>
<pre><code>##           llh       llhNull            G2      McFadden          r2ML          r2CU 
##  -623.9804020 -1369.2239672  1490.4871304     0.5442817     0.7344776     0.8048896</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="spatial-modeling-leukemia.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(resid_Pois_Hurdle, mat[[<span class="fu">which.max</span>(aux)]], <span class="at">alternative=</span><span class="st">&quot;two.sided&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Moran I test under randomisation
## 
## data:  resid_Pois_Hurdle  
## weights: mat[[which.max(aux)]]    
## 
## Moran I statistic standard deviate = 4.8924, p-value = 9.964e-07
## alternative hypothesis: two.sided
## sample estimates:
## Moran I statistic       Expectation          Variance 
##      0.0935041339     -0.0008904720      0.0003722701</code></pre>
<ul>
<li><strong><em>Only Conflict armed index predictor is significant but model residuals are significantly spatially autocorrelated. So, we use spatial filtering and check significance again. Below we find Moran Eigenvectors.</em></strong></li>
</ul>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="spatial-modeling-leukemia.html#cb70-1" aria-hidden="true" tabindex="-1"></a>MEpoisLMR <span class="ot">&lt;-</span> spatialreg<span class="sc">::</span><span class="fu">ME</span>(Ndeaths <span class="sc">~</span> IICA_High<span class="sc">+</span>UBN<span class="sc">+</span>Per_Rur<span class="sc">+</span>Cobertura<span class="sc">+</span><span class="fu">offset</span>(<span class="fu">log</span>(EsperadosDeNCancer)),<span class="at">data=</span>muncol,<span class="at">family=</span><span class="st">&quot;poisson&quot;</span>,<span class="at">listw=</span>knn4_nb_b, <span class="at">alpha=</span><span class="fl">0.02</span>, <span class="at">verbose=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## eV[,11], I: 0.02918226 ZI: NA, pr(ZI): 0.04</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="spatial-modeling-leukemia.html#cb72-1" aria-hidden="true" tabindex="-1"></a>MoranEigenVLMR<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">fitted</span>(MEpoisLMR))</span>
<span id="cb72-2"><a href="spatial-modeling-leukemia.html#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(MoranEigenVLMR)</span></span></code></pre></div>
<ul>
<li><strong><em>Now, we used Poisson Hurdle model to manage the overdispersion due to zero excess and Moran eigenfunctions are included as additional explanatory variables, so that spatial autocorrelation is considered.</em></strong></li>
</ul>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="spatial-modeling-leukemia.html#cb73-1" aria-hidden="true" tabindex="-1"></a>mod.hurdleLMR <span class="ot">&lt;-</span> <span class="fu">hurdle</span>(Ndeaths <span class="sc">~</span>IICA_High<span class="sc">+</span>UBN<span class="sc">+</span>Per_Rur<span class="sc">+</span>Cobertura<span class="sc">+</span><span class="fu">fitted</span>(MEpoisLMR)<span class="sc">+</span><span class="fu">offset</span>(<span class="fu">log</span>(EsperadosDeNCancer))<span class="sc">|</span>IICA_High<span class="sc">+</span>UBN<span class="sc">+</span>Per_Rur<span class="sc">+</span>Cobertura<span class="sc">+</span><span class="fu">offset</span>(<span class="fu">log</span>(EsperadosDeNCancer)),<span class="at">data =</span> muncol,<span class="at">dist =</span> <span class="st">&quot;poisson&quot;</span>, <span class="at">zero.dist =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb73-2"><a href="spatial-modeling-leukemia.html#cb73-2" aria-hidden="true" tabindex="-1"></a>resid_Pois_Hurdle<span class="ot">=</span><span class="fu">residuals</span>(mod.hurdleLMR,<span class="st">&quot;response&quot;</span>)</span>
<span id="cb73-3"><a href="spatial-modeling-leukemia.html#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod.hurdleLMR)</span></code></pre></div>
<pre><code>## 
## Call:
## hurdle(formula = Ndeaths ~ IICA_High + UBN + Per_Rur + Cobertura + fitted(MEpoisLMR) + offset(log(EsperadosDeNCancer)) | 
##     IICA_High + UBN + Per_Rur + Cobertura + offset(log(EsperadosDeNCancer)), data = muncol, dist = &quot;poisson&quot;, 
##     zero.dist = &quot;binomial&quot;)
## 
## Pearson residuals:
##     Min      1Q  Median      3Q     Max 
## -1.6969 -0.4153 -0.2920 -0.1791  7.8744 
## 
## Count model coefficients (truncated poisson with log link):
##                    Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)        0.374295   0.391853   0.955  0.33948    
## IICA_High1         0.286868   0.104433   2.747  0.00602 ** 
## UBN               -0.010727   0.005917  -1.813  0.06986 .  
## Per_Rur           -0.003464   0.005096  -0.680  0.49664    
## Cobertura         -0.058726   0.436141  -0.135  0.89289    
## fitted(MEpoisLMR) -8.856022   1.670191  -5.302 1.14e-07 ***
## Zero hurdle model coefficients (binomial with logit link):
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.013658   0.570592  -1.777 0.075650 .  
## IICA_High1  -0.091317   0.177363  -0.515 0.606652    
## UBN         -0.011792   0.004690  -2.514 0.011928 *  
## Per_Rur     -0.005190   0.003982  -1.303 0.192473    
## Cobertura    2.283308   0.624231   3.658 0.000254 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 
## 
## Number of iterations in BFGS optimization: 12 
## Log-likelihood:  -610 on 11 Df</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="spatial-modeling-leukemia.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pR2</span>(mod.hurdleLMR)</span></code></pre></div>
<pre><code>## fitting null model for pseudo-r2</code></pre>
<pre><code>##           llh       llhNull            G2      McFadden          r2ML          r2CU 
##  -610.0288758 -1369.2239672  1518.3901828     0.5544711     0.7409880     0.8120241</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="spatial-modeling-leukemia.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(resid_Pois_Hurdle, mat[[<span class="fu">which.max</span>(aux)]], <span class="at">alternative=</span><span class="st">&quot;two.sided&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Moran I test under randomisation
## 
## data:  resid_Pois_Hurdle  
## weights: mat[[which.max(aux)]]    
## 
## Moran I statistic standard deviate = 1.4546, p-value = 0.1458
## alternative hypothesis: two.sided
## sample estimates:
## Moran I statistic       Expectation          Variance 
##       0.027522708      -0.000890472       0.000381564</code></pre>
<ul>
<li><strong><em>Rurality and health coverage are not statistically significant for counto model. So, those predictors are excluded of the spatial filtering and model.</em></strong></li>
</ul>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="spatial-modeling-leukemia.html#cb80-1" aria-hidden="true" tabindex="-1"></a>MEpoisLMR <span class="ot">&lt;-</span> spatialreg<span class="sc">::</span><span class="fu">ME</span>(Ndeaths <span class="sc">~</span> IICA_High<span class="sc">+</span>UBN<span class="sc">+</span><span class="fu">offset</span>(<span class="fu">log</span>(EsperadosDeNCancer)),<span class="at">data=</span>muncol,<span class="at">family=</span><span class="st">&quot;poisson&quot;</span>,<span class="at">listw=</span>knn4_nb_b, <span class="at">alpha=</span><span class="fl">0.02</span>, <span class="at">verbose=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## eV[,11], I: 0.01071212 ZI: NA, pr(ZI): 0.26</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="spatial-modeling-leukemia.html#cb82-1" aria-hidden="true" tabindex="-1"></a>MoranEigenVLMR<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">fitted</span>(MEpoisLMR))</span>
<span id="cb82-2"><a href="spatial-modeling-leukemia.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(MoranEigenVLMR)</span></span></code></pre></div>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="spatial-modeling-leukemia.html#cb83-1" aria-hidden="true" tabindex="-1"></a>mod.hurdleLMR <span class="ot">&lt;-</span> <span class="fu">hurdle</span>(Ndeaths <span class="sc">~</span>IICA_High<span class="sc">+</span>UBN<span class="sc">+</span><span class="fu">fitted</span>(MEpoisLMR)<span class="sc">+</span><span class="fu">offset</span>(<span class="fu">log</span>(EsperadosDeNCancer))<span class="sc">|</span>UBN<span class="sc">+</span>Cobertura<span class="sc">+</span><span class="fu">offset</span>(<span class="fu">log</span>(EsperadosDeNCancer)),<span class="at">data =</span> muncol,<span class="at">dist =</span> <span class="st">&quot;poisson&quot;</span>, <span class="at">zero.dist =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb83-2"><a href="spatial-modeling-leukemia.html#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod.hurdleLMR)</span></code></pre></div>
<pre><code>## 
## Call:
## hurdle(formula = Ndeaths ~ IICA_High + UBN + fitted(MEpoisLMR) + offset(log(EsperadosDeNCancer)) | UBN + 
##     Cobertura + offset(log(EsperadosDeNCancer)), data = muncol, dist = &quot;poisson&quot;, zero.dist = &quot;binomial&quot;)
## 
## Pearson residuals:
##     Min      1Q  Median      3Q     Max 
## -1.5905 -0.4184 -0.2973 -0.1823  7.3265 
## 
## Count model coefficients (truncated poisson with log link):
##                    Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)        0.355460   0.097724   3.637 0.000275 ***
## IICA_High1         0.274468   0.100011   2.744 0.006062 ** 
## UBN               -0.013803   0.003796  -3.636 0.000277 ***
## fitted(MEpoisLMR) -9.134355   1.617421  -5.647 1.63e-08 ***
## Zero hurdle model coefficients (binomial with logit link):
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.279352   0.535993  -2.387 0.016992 *  
## UBN         -0.014391   0.004288  -3.356 0.000789 ***
## Cobertura    2.354642   0.616661   3.818 0.000134 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 
## 
## Number of iterations in BFGS optimization: 11 
## Log-likelihood: -611.3 on 7 Df</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="spatial-modeling-leukemia.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pR2</span>(mod.hurdleLMR)</span></code></pre></div>
<pre><code>## fitting null model for pseudo-r2</code></pre>
<pre><code>##           llh       llhNull            G2      McFadden          r2ML          r2CU 
##  -611.2637930 -1369.2239672  1515.9203483     0.5535692     0.7404182     0.8113997</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="spatial-modeling-leukemia.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(resid_Pois_Hurdle, mat[[<span class="fu">which.max</span>(aux)]], <span class="at">alternative=</span><span class="st">&quot;two.sided&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Moran I test under randomisation
## 
## data:  resid_Pois_Hurdle  
## weights: mat[[which.max(aux)]]    
## 
## Moran I statistic standard deviate = 1.4546, p-value = 0.1458
## alternative hypothesis: two.sided
## sample estimates:
## Moran I statistic       Expectation          Variance 
##       0.027522708      -0.000890472       0.000381564</code></pre>
<ul>
<li><strong><em>Now, Poisson-Hurdle model residuals are not significant spatially autocorrelated. The LMR’s positive values depend only on the Index of armed conflict (IICA) and on the unsatisfied basic needs index (UBN) and LMR’s zero values depend on the UBN and health coverage. Note that the model shows good performance, according to pseudo R2 and the comparison between observed and predicted frequencies.</em></strong></li>
</ul>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="spatial-modeling-leukemia.html#cb90-1" aria-hidden="true" tabindex="-1"></a>mf <span class="ot">&lt;-</span> <span class="fu">model.frame</span>(mod.hurdleLMR)</span>
<span id="cb90-2"><a href="spatial-modeling-leukemia.html#cb90-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">model.response</span>(mf)</span>
<span id="cb90-3"><a href="spatial-modeling-leukemia.html#cb90-3" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">model.weights</span>(mf)</span>
<span id="cb90-4"><a href="spatial-modeling-leukemia.html#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.null</span>(w)) w <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">NROW</span>(y))</span>
<span id="cb90-5"><a href="spatial-modeling-leukemia.html#cb90-5" aria-hidden="true" tabindex="-1"></a>max0 <span class="ot">&lt;-</span> 20L</span>
<span id="cb90-6"><a href="spatial-modeling-leukemia.html#cb90-6" aria-hidden="true" tabindex="-1"></a>obs <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">xtabs</span>(w <span class="sc">~</span> <span class="fu">factor</span>(y, <span class="at">levels =</span> 0L<span class="sc">:</span>max0)))</span>
<span id="cb90-7"><a href="spatial-modeling-leukemia.html#cb90-7" aria-hidden="true" tabindex="-1"></a>exp <span class="ot">&lt;-</span> <span class="fu">colSums</span>(<span class="fu">predict</span>(mod.hurdleLMR, <span class="at">type =</span> <span class="st">&quot;prob&quot;</span>, <span class="at">at =</span> 0L<span class="sc">:</span>max0) <span class="sc">*</span> w)</span>
<span id="cb90-8"><a href="spatial-modeling-leukemia.html#cb90-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-9"><a href="spatial-modeling-leukemia.html#cb90-9" aria-hidden="true" tabindex="-1"></a>fitted_vs_observed <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Expected =</span> exp,</span>
<span id="cb90-10"><a href="spatial-modeling-leukemia.html#cb90-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Observed =</span> obs)</span>
<span id="cb90-11"><a href="spatial-modeling-leukemia.html#cb90-11" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(fitted_vs_observed)</span></code></pre></div>
<pre><code>## No id variables; using all as measure variables</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="spatial-modeling-leukemia.html#cb92-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(data, <span class="at">x =</span>  <span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb92-2"><a href="spatial-modeling-leukemia.html#cb92-2" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> data[<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>, ]</span>
<span id="cb92-3"><a href="spatial-modeling-leukemia.html#cb92-3" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> data[<span class="dv">22</span><span class="sc">:</span><span class="dv">42</span>, ]</span>
<span id="cb92-4"><a href="spatial-modeling-leukemia.html#cb92-4" aria-hidden="true" tabindex="-1"></a>pMortality <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb92-5"><a href="spatial-modeling-leukemia.html#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(data1, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value, <span class="at">group =</span> variable</span>
<span id="cb92-6"><a href="spatial-modeling-leukemia.html#cb92-6" aria-hidden="true" tabindex="-1"></a>                          , <span class="at">color =</span> variable)) <span class="sc">+</span></span>
<span id="cb92-7"><a href="spatial-modeling-leukemia.html#cb92-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(data1, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value, <span class="at">group =</span> variable,</span>
<span id="cb92-8"><a href="spatial-modeling-leukemia.html#cb92-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">color =</span> variable)) <span class="sc">+</span></span>
<span id="cb92-9"><a href="spatial-modeling-leukemia.html#cb92-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(data2, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value, <span class="at">group =</span> variable),</span>
<span id="cb92-10"><a href="spatial-modeling-leukemia.html#cb92-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb92-11"><a href="spatial-modeling-leukemia.html#cb92-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb92-12"><a href="spatial-modeling-leukemia.html#cb92-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of deaths&quot;</span>,</span>
<span id="cb92-13"><a href="spatial-modeling-leukemia.html#cb92-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Frecuencies&quot;</span>)</span>
<span id="cb92-14"><a href="spatial-modeling-leukemia.html#cb92-14" aria-hidden="true" tabindex="-1"></a>pMortality</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
</div>
</div>
<div id="incidence" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Incidence<a href="spatial-modeling-leukemia.html#incidence" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Spatial modeling of incidence and mortality childhood leukemia based on Colombian armed conflict and poverty for children born during the years 2002-2013</p>
<div id="packages-incidence" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> <strong>Packages Incidence</strong><a href="spatial-modeling-leukemia.html#packages-incidence" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="spatial-modeling-leukemia.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb93-2"><a href="spatial-modeling-leukemia.html#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(rgdal)</span>
<span id="cb93-3"><a href="spatial-modeling-leukemia.html#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(pscl)</span>
<span id="cb93-4"><a href="spatial-modeling-leukemia.html#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(sf)</span>
<span id="cb93-5"><a href="spatial-modeling-leukemia.html#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(spdep)</span>
<span id="cb93-6"><a href="spatial-modeling-leukemia.html#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(spatialreg) <span class="co">#test.W, scores.listw</span></span>
<span id="cb93-7"><a href="spatial-modeling-leukemia.html#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(stringr)</span>
<span id="cb93-8"><a href="spatial-modeling-leukemia.html#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(performance)</span>
<span id="cb93-9"><a href="spatial-modeling-leukemia.html#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(AER)</span>
<span id="cb93-10"><a href="spatial-modeling-leukemia.html#cb93-10" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggplot2)</span>
<span id="cb93-11"><a href="spatial-modeling-leukemia.html#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(vcdExtra)</span></code></pre></div>
</div>
<div id="code-incidence" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> <em>Code Incidence</em><a href="spatial-modeling-leukemia.html#code-incidence" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><strong>Reading the shapefile of 1124 Colombian municipalities, defining the Coordinate Reference System and centroid and building some variables</strong></li>
</ul>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="spatial-modeling-leukemia.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Reading the shapefile of 1124 Colombian municipalities</span></span>
<span id="cb94-2"><a href="spatial-modeling-leukemia.html#cb94-2" aria-hidden="true" tabindex="-1"></a>muncol <span class="ot">&lt;-</span> rgdal<span class="sc">::</span><span class="fu">readOGR</span>(<span class="at">dsn=</span><span class="st">&quot;Armed_Conflict_Vs_Leukemia/muncol.shp&quot;</span>)</span></code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;/home/jncc/Documents/Monitorias/EspacialPage/Clases-EE-UN/Armed_Conflict_Vs_Leukemia/muncol.shp&quot;, layer: &quot;muncol&quot;
## with 1124 features
## It has 17 fields</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="spatial-modeling-leukemia.html#cb96-1" aria-hidden="true" tabindex="-1"></a>muncol<span class="ot">=</span><span class="fu">spTransform</span>(muncol,<span class="fu">CRS</span>(<span class="st">&quot;+init=epsg:21897&quot;</span>))</span>
<span id="cb96-2"><a href="spatial-modeling-leukemia.html#cb96-2" aria-hidden="true" tabindex="-1"></a>(l <span class="ot">&lt;-</span> <span class="fu">length</span>(muncol))</span></code></pre></div>
<pre><code>## [1] 1124</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="spatial-modeling-leukemia.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Representative coordinate (centroid)</span></span>
<span id="cb98-2"><a href="spatial-modeling-leukemia.html#cb98-2" aria-hidden="true" tabindex="-1"></a>xy0<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">x=</span>muncol<span class="sc">$</span>x,<span class="at">y=</span>muncol<span class="sc">$</span>y)</span>
<span id="cb98-3"><a href="spatial-modeling-leukemia.html#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(xy0) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;x&#39;</span>,<span class="st">&#39;y&#39;</span>)</span>
<span id="cb98-4"><a href="spatial-modeling-leukemia.html#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="fu">proj4string</span>(xy0) <span class="ot">&lt;-</span> <span class="fu">CRS</span>(<span class="st">&quot;+init=epsg:4326&quot;</span>)</span>
<span id="cb98-5"><a href="spatial-modeling-leukemia.html#cb98-5" aria-hidden="true" tabindex="-1"></a>xy0<span class="ot">=</span><span class="fu">spTransform</span>(xy0,<span class="fu">CRS</span>(<span class="st">&quot;+init=epsg:21897&quot;</span>))</span>
<span id="cb98-6"><a href="spatial-modeling-leukemia.html#cb98-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-7"><a href="spatial-modeling-leukemia.html#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="do">###Loops for avoiding NA </span></span>
<span id="cb98-8"><a href="spatial-modeling-leukemia.html#cb98-8" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">sum</span>(muncol<span class="sc">$</span>NCases)<span class="sc">/</span><span class="fu">sum</span>(muncol<span class="sc">$</span>NPop)</span>
<span id="cb98-9"><a href="spatial-modeling-leukemia.html#cb98-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>l){ </span>
<span id="cb98-10"><a href="spatial-modeling-leukemia.html#cb98-10" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span>(muncol<span class="sc">$</span>NPop[i]<span class="sc">==</span><span class="dv">0</span>){</span>
<span id="cb98-11"><a href="spatial-modeling-leukemia.html#cb98-11" aria-hidden="true" tabindex="-1"></a>      muncol<span class="sc">$</span>EsperadosNCancer[i] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb98-12"><a href="spatial-modeling-leukemia.html#cb98-12" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb98-13"><a href="spatial-modeling-leukemia.html#cb98-13" aria-hidden="true" tabindex="-1"></a>   <span class="cf">else</span>{</span>
<span id="cb98-14"><a href="spatial-modeling-leukemia.html#cb98-14" aria-hidden="true" tabindex="-1"></a>      muncol<span class="sc">$</span>EsperadosNCancer[i] <span class="ot">&lt;-</span> muncol<span class="sc">$</span>NPop[i]<span class="sc">*</span>r</span>
<span id="cb98-15"><a href="spatial-modeling-leukemia.html#cb98-15" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb98-16"><a href="spatial-modeling-leukemia.html#cb98-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb98-17"><a href="spatial-modeling-leukemia.html#cb98-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-18"><a href="spatial-modeling-leukemia.html#cb98-18" aria-hidden="true" tabindex="-1"></a>muncol<span class="sc">$</span>IICA_Cat<span class="ot">=</span>muncol<span class="sc">$</span>IICA_Ca</span>
<span id="cb98-19"><a href="spatial-modeling-leukemia.html#cb98-19" aria-hidden="true" tabindex="-1"></a>muncol<span class="sc">$</span>IICA_Cat<span class="ot">=</span><span class="fu">str_replace_all</span>(muncol<span class="sc">$</span>IICA_Cat,<span class="st">&quot;Bajo&quot;</span>, <span class="st">&quot;Low&quot;</span>)</span>
<span id="cb98-20"><a href="spatial-modeling-leukemia.html#cb98-20" aria-hidden="true" tabindex="-1"></a>muncol<span class="sc">$</span>IICA_Cat<span class="ot">=</span><span class="fu">str_replace_all</span>(muncol<span class="sc">$</span>IICA_Cat,<span class="st">&quot;Medio&quot;</span>, <span class="st">&quot;Medium&quot;</span>)</span>
<span id="cb98-21"><a href="spatial-modeling-leukemia.html#cb98-21" aria-hidden="true" tabindex="-1"></a>muncol<span class="sc">$</span>IICA_CatLow<span class="ot">=</span><span class="fu">ifelse</span>(muncol<span class="sc">$</span>IICA_Cat<span class="sc">==</span><span class="st">&quot;Low&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb98-22"><a href="spatial-modeling-leukemia.html#cb98-22" aria-hidden="true" tabindex="-1"></a>muncol<span class="sc">$</span>IICA_CatMed<span class="ot">=</span><span class="fu">ifelse</span>(muncol<span class="sc">$</span>IICA_Cat<span class="sc">==</span><span class="st">&quot;Medium&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb98-23"><a href="spatial-modeling-leukemia.html#cb98-23" aria-hidden="true" tabindex="-1"></a>muncol<span class="sc">$</span>IICA_High<span class="ot">=</span><span class="fu">as.character</span>(<span class="dv">1</span><span class="sc">-</span>(muncol<span class="sc">$</span>IICA_CatLow<span class="sc">+</span>muncol<span class="sc">$</span>IICA_CatMed))</span>
<span id="cb98-24"><a href="spatial-modeling-leukemia.html#cb98-24" aria-hidden="true" tabindex="-1"></a>muncol<span class="sc">$</span>UBN<span class="ot">=</span>muncol<span class="sc">$</span>NBI</span></code></pre></div>
<ul>
<li><strong>Modeling leukemia Incidence Rate (LR) in terms of Colombian armed conflict index, poverty and rurality. First, the usual Poisson regression model with incidence rate as response variable is estimated.</strong></li>
</ul>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="spatial-modeling-leukemia.html#cb99-1" aria-hidden="true" tabindex="-1"></a>glmbaseLR<span class="ot">&lt;-</span><span class="fu">glm</span>(NCases <span class="sc">~</span>IICA_High<span class="sc">+</span>UBN<span class="sc">+</span>Per_Rur<span class="sc">+</span><span class="fu">offset</span>(<span class="fu">log</span>(EsperadosNCancer)), <span class="at">family =</span> poisson,<span class="at">data =</span> muncol)</span>
<span id="cb99-2"><a href="spatial-modeling-leukemia.html#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(glmbaseLR)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model: poisson, link: log
## 
## Response: NCases
## 
## Terms added sequentially (first to last)
## 
## 
##           Df Deviance Resid. Df Resid. Dev
## NULL                       1123     2524.9
## IICA_High  1     0.75      1122     2524.1
## UBN        1   328.90      1121     2195.2
## Per_Rur    1     0.11      1120     2195.1</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="spatial-modeling-leukemia.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glmbaseLR)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = NCases ~ IICA_High + UBN + Per_Rur + offset(log(EsperadosNCancer)), 
##     family = poisson, data = muncol)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -5.1779  -1.1632  -0.5270   0.6082   7.7193  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  0.3226036  0.0276280  11.677  &lt; 2e-16 ***
## IICA_High1   0.0818208  0.0294297   2.780  0.00543 ** 
## UBN         -0.0123797  0.0010425 -11.875  &lt; 2e-16 ***
## Per_Rur     -0.0002510  0.0007692  -0.326  0.74419    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 2524.9  on 1123  degrees of freedom
## Residual deviance: 2195.1  on 1120  degrees of freedom
## AIC: 4174.2
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="spatial-modeling-leukemia.html#cb103-1" aria-hidden="true" tabindex="-1"></a>muncol<span class="sc">$</span>residLR<span class="ot">=</span><span class="fu">residuals</span>(glmbaseLR)</span></code></pre></div>
<ul>
<li><p><strong><em>Rurality is not statistically significant in this first auxiliar model. However, we maintain this variable in the rest of the analysis and review its significance in the final model.</em></strong></p></li>
<li><p><strong><em>Checking excess zeros by comparison between the number of zeros predicted by the model with the observed number of zeros. Also checking overdispersion.</em></strong></p></li>
</ul>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="spatial-modeling-leukemia.html#cb104-1" aria-hidden="true" tabindex="-1"></a>mu_LR <span class="ot">&lt;-</span> <span class="fu">predict</span>(glmbaseLR, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)  <span class="co"># predict expected mean count</span></span>
<span id="cb104-2"><a href="spatial-modeling-leukemia.html#cb104-2" aria-hidden="true" tabindex="-1"></a>expLR <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">dpois</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">lambda =</span> mu_LR))      <span class="co"># sum the probabilities of a zero count for each mean</span></span>
<span id="cb104-3"><a href="spatial-modeling-leukemia.html#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(expLR)                                    <span class="co">#predicted number of zeros</span></span></code></pre></div>
<pre><code>## [1] 382</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="spatial-modeling-leukemia.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(muncol<span class="sc">$</span>NCases <span class="sc">&lt;</span> <span class="dv">1</span>)                          <span class="co">#observed number of zeros</span></span></code></pre></div>
<pre><code>## [1] 443</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="spatial-modeling-leukemia.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">zero.test</span>(muncol<span class="sc">$</span>NCases)                        <span class="co">#score test (van den Broek, 1995)</span></span></code></pre></div>
<pre><code>## Score test for zero inflation
## 
##      Chi-square = 12268.7129 
##      df = 1
##      pvalue: &lt; 2.22e-16</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="spatial-modeling-leukemia.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="do">##Checking overdispersion</span></span>
<span id="cb110-2"><a href="spatial-modeling-leukemia.html#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dispersiontest</span>(glmbaseLR)             <span class="co">#Cameron &amp; Trivedi (1990)</span></span></code></pre></div>
<pre><code>## 
##  Overdispersion test
## 
## data:  glmbaseLR
## z = 4.1887, p-value = 1.403e-05
## alternative hypothesis: true dispersion is greater than 1
## sample estimates:
## dispersion 
##   2.309041</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="spatial-modeling-leukemia.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_overdispersion</span>(glmbaseLR)       <span class="co">#Gelman and Hill (2007)</span></span></code></pre></div>
<pre><code>## # Overdispersion test
## 
##        dispersion ratio =    2.431
##   Pearson&#39;s Chi-Squared = 2722.353
##                 p-value =  &lt; 0.001</code></pre>
<pre><code>## Overdispersion detected.</code></pre>
<ul>
<li><p><strong><em>The observed frequency of zeroes in data exceeds the predicted in the Leukemia incidence rate (LR) model. Also, overdispersion is detected.</em></strong></p></li>
<li><p><strong><em>Now, to validate the independence assumption, first, it is necessary to define spatial weighting possible matrices.</em></strong></p></li>
</ul>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="spatial-modeling-leukemia.html#cb115-1" aria-hidden="true" tabindex="-1"></a>rook_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">poly2nb</span>(muncol,<span class="at">queen=</span><span class="cn">FALSE</span>), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-2"><a href="spatial-modeling-leukemia.html#cb115-2" aria-hidden="true" tabindex="-1"></a>rook_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">poly2nb</span>(muncol,<span class="at">queen=</span><span class="cn">FALSE</span>), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-3"><a href="spatial-modeling-leukemia.html#cb115-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a href="spatial-modeling-leukemia.html#cb115-4" aria-hidden="true" tabindex="-1"></a>queen_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">poly2nb</span>(muncol,<span class="at">queen=</span><span class="cn">TRUE</span>), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-5"><a href="spatial-modeling-leukemia.html#cb115-5" aria-hidden="true" tabindex="-1"></a>queen_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">poly2nb</span>(muncol,<span class="at">queen=</span><span class="cn">TRUE</span>), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-6"><a href="spatial-modeling-leukemia.html#cb115-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-7"><a href="spatial-modeling-leukemia.html#cb115-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Graphs neighbours</span></span>
<span id="cb115-8"><a href="spatial-modeling-leukemia.html#cb115-8" aria-hidden="true" tabindex="-1"></a>trinb<span class="ot">=</span><span class="fu">tri2nb</span>(xy0)</span>
<span id="cb115-9"><a href="spatial-modeling-leukemia.html#cb115-9" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">warn =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb115-10"><a href="spatial-modeling-leukemia.html#cb115-10" aria-hidden="true" tabindex="-1"></a>tri_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">tri2nb</span>(xy0), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-11"><a href="spatial-modeling-leukemia.html#cb115-11" aria-hidden="true" tabindex="-1"></a>tri_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">tri2nb</span>(xy0), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-12"><a href="spatial-modeling-leukemia.html#cb115-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-13"><a href="spatial-modeling-leukemia.html#cb115-13" aria-hidden="true" tabindex="-1"></a>soi_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">graph2nb</span>(<span class="fu">soi.graph</span>(trinb,xy0)), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-14"><a href="spatial-modeling-leukemia.html#cb115-14" aria-hidden="true" tabindex="-1"></a>soi_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">graph2nb</span>(<span class="fu">soi.graph</span>(trinb,xy0)), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-15"><a href="spatial-modeling-leukemia.html#cb115-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-16"><a href="spatial-modeling-leukemia.html#cb115-16" aria-hidden="true" tabindex="-1"></a>relative_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">graph2nb</span>(<span class="fu">relativeneigh</span>(xy0), <span class="at">sym=</span><span class="cn">TRUE</span>), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-17"><a href="spatial-modeling-leukemia.html#cb115-17" aria-hidden="true" tabindex="-1"></a>relative_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">graph2nb</span>(<span class="fu">relativeneigh</span>(xy0), <span class="at">sym=</span><span class="cn">TRUE</span>), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-18"><a href="spatial-modeling-leukemia.html#cb115-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-19"><a href="spatial-modeling-leukemia.html#cb115-19" aria-hidden="true" tabindex="-1"></a>gabriel_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">graph2nb</span>(<span class="fu">gabrielneigh</span>(xy0), <span class="at">sym=</span><span class="cn">TRUE</span>), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-20"><a href="spatial-modeling-leukemia.html#cb115-20" aria-hidden="true" tabindex="-1"></a>gabriel_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">graph2nb</span>(<span class="fu">gabrielneigh</span>(xy0), <span class="at">sym=</span><span class="cn">TRUE</span>), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-21"><a href="spatial-modeling-leukemia.html#cb115-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-22"><a href="spatial-modeling-leukemia.html#cb115-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Distance neighbours</span></span>
<span id="cb115-23"><a href="spatial-modeling-leukemia.html#cb115-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-24"><a href="spatial-modeling-leukemia.html#cb115-24" aria-hidden="true" tabindex="-1"></a>knn1_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(xy0, <span class="at">k =</span> <span class="dv">1</span>)), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-25"><a href="spatial-modeling-leukemia.html#cb115-25" aria-hidden="true" tabindex="-1"></a>knn1_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(xy0, <span class="at">k =</span> <span class="dv">1</span>)), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-26"><a href="spatial-modeling-leukemia.html#cb115-26" aria-hidden="true" tabindex="-1"></a>knn2_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(xy0, <span class="at">k =</span> <span class="dv">2</span>)), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-27"><a href="spatial-modeling-leukemia.html#cb115-27" aria-hidden="true" tabindex="-1"></a>knn2_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(xy0, <span class="at">k =</span> <span class="dv">2</span>)), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-28"><a href="spatial-modeling-leukemia.html#cb115-28" aria-hidden="true" tabindex="-1"></a>knn3_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(xy0, <span class="at">k =</span> <span class="dv">3</span>)), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-29"><a href="spatial-modeling-leukemia.html#cb115-29" aria-hidden="true" tabindex="-1"></a>knn3_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(xy0, <span class="at">k =</span> <span class="dv">3</span>)), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-30"><a href="spatial-modeling-leukemia.html#cb115-30" aria-hidden="true" tabindex="-1"></a>knn4_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(xy0, <span class="at">k =</span> <span class="dv">4</span>)), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-31"><a href="spatial-modeling-leukemia.html#cb115-31" aria-hidden="true" tabindex="-1"></a>knn4_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(xy0, <span class="at">k =</span> <span class="dv">4</span>)), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-32"><a href="spatial-modeling-leukemia.html#cb115-32" aria-hidden="true" tabindex="-1"></a>knn6_nb_b<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(xy0, <span class="at">k =</span> <span class="dv">6</span>)), <span class="at">style=</span><span class="st">&quot;B&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-33"><a href="spatial-modeling-leukemia.html#cb115-33" aria-hidden="true" tabindex="-1"></a>knn6_nb_w<span class="ot">=</span><span class="fu">nb2listw</span>(<span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(xy0, <span class="at">k =</span> <span class="dv">6</span>)), <span class="at">style=</span><span class="st">&quot;W&quot;</span>,<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-34"><a href="spatial-modeling-leukemia.html#cb115-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-35"><a href="spatial-modeling-leukemia.html#cb115-35" aria-hidden="true" tabindex="-1"></a>mat<span class="ot">=</span><span class="fu">list</span>(rook_nb_b,rook_nb_w,</span>
<span id="cb115-36"><a href="spatial-modeling-leukemia.html#cb115-36" aria-hidden="true" tabindex="-1"></a>         queen_nb_b,queen_nb_w,</span>
<span id="cb115-37"><a href="spatial-modeling-leukemia.html#cb115-37" aria-hidden="true" tabindex="-1"></a>         tri_nb_b,tri_nb_w,</span>
<span id="cb115-38"><a href="spatial-modeling-leukemia.html#cb115-38" aria-hidden="true" tabindex="-1"></a>         soi_nb_b,soi_nb_w,</span>
<span id="cb115-39"><a href="spatial-modeling-leukemia.html#cb115-39" aria-hidden="true" tabindex="-1"></a>         gabriel_nb_b,gabriel_nb_w,</span>
<span id="cb115-40"><a href="spatial-modeling-leukemia.html#cb115-40" aria-hidden="true" tabindex="-1"></a>         relative_nb_b,relative_nb_w,</span>
<span id="cb115-41"><a href="spatial-modeling-leukemia.html#cb115-41" aria-hidden="true" tabindex="-1"></a>         knn1_nb_b,knn1_nb_w,</span>
<span id="cb115-42"><a href="spatial-modeling-leukemia.html#cb115-42" aria-hidden="true" tabindex="-1"></a>         knn2_nb_b,knn2_nb_w,</span>
<span id="cb115-43"><a href="spatial-modeling-leukemia.html#cb115-43" aria-hidden="true" tabindex="-1"></a>         knn3_nb_b,knn3_nb_w,</span>
<span id="cb115-44"><a href="spatial-modeling-leukemia.html#cb115-44" aria-hidden="true" tabindex="-1"></a>         knn4_nb_b,knn4_nb_w,</span>
<span id="cb115-45"><a href="spatial-modeling-leukemia.html#cb115-45" aria-hidden="true" tabindex="-1"></a>         knn6_nb_b,knn6_nb_w)</span></code></pre></div>
<ul>
<li><strong><em>Testing spatial autocorrelation using Moran index test based on weighting matrices built in the last step. Note that with all weighting matrices we obtain a significant spatial autocorrelation.</em></strong></li>
</ul>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="spatial-modeling-leukemia.html#cb116-1" aria-hidden="true" tabindex="-1"></a>aux<span class="ot">=</span><span class="fu">numeric</span>(<span class="dv">0</span>)</span>
<span id="cb116-2"><a href="spatial-modeling-leukemia.html#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">warn =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb116-3"><a href="spatial-modeling-leukemia.html#cb116-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb116-4"><a href="spatial-modeling-leukemia.html#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(mat))</span>
<span id="cb116-5"><a href="spatial-modeling-leukemia.html#cb116-5" aria-hidden="true" tabindex="-1"></a>aux[i]<span class="ot">=</span><span class="fu">moran.test</span>(muncol<span class="sc">$</span>residLR,mat[[i]],<span class="at">alternative=</span><span class="st">&quot;two.sided&quot;</span>)<span class="sc">$</span><span class="st">&quot;p&quot;</span></span>
<span id="cb116-6"><a href="spatial-modeling-leukemia.html#cb116-6" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb116-7"><a href="spatial-modeling-leukemia.html#cb116-7" aria-hidden="true" tabindex="-1"></a>aux</span></code></pre></div>
<pre><code>##  [1] 1.776445e-09 1.630534e-11 1.116295e-09 3.409196e-11 2.619438e-10 1.984900e-11 2.800074e-11 2.648473e-11
##  [9] 7.073103e-11 4.068005e-12 1.345336e-09 5.867655e-09 6.342820e-04 6.342820e-04 5.337856e-09 5.337856e-09
## [17] 4.653660e-12 4.653660e-12 2.138542e-13 2.138542e-13 5.932765e-13 5.932765e-13</code></pre>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="spatial-modeling-leukemia.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(muncol<span class="sc">$</span>residLR, mat[[<span class="fu">which.max</span>(aux)]], <span class="at">alternative=</span><span class="st">&quot;two.sided&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Moran I test under randomisation
## 
## data:  muncol$residLR  
## weights: mat[[which.max(aux)]]    
## 
## Moran I statistic standard deviate = 3.4165, p-value = 0.0006343
## alternative hypothesis: two.sided
## sample estimates:
## Moran I statistic       Expectation          Variance 
##       0.123653792      -0.000890472       0.001328865</code></pre>
<ul>
<li><strong><em>First, Poisson Hurdle model is estimated without consider spatial autocorrelation.</em></strong></li>
</ul>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="spatial-modeling-leukemia.html#cb120-1" aria-hidden="true" tabindex="-1"></a>mod.hurdleLR <span class="ot">&lt;-</span> <span class="fu">hurdle</span>(NCases <span class="sc">~</span>IICA_High<span class="sc">+</span>UBN<span class="sc">+</span>Per_Rur<span class="sc">+</span><span class="fu">offset</span>(<span class="fu">log</span>(EsperadosNCancer))<span class="sc">|</span>IICA_High<span class="sc">+</span>UBN<span class="sc">+</span>Per_Rur<span class="sc">+</span><span class="fu">offset</span>(<span class="fu">log</span>(EsperadosNCancer)),<span class="at">data =</span> muncol,<span class="at">dist =</span> <span class="st">&quot;poisson&quot;</span>, <span class="at">zero.dist =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb120-2"><a href="spatial-modeling-leukemia.html#cb120-2" aria-hidden="true" tabindex="-1"></a>resid_Pois_Hurdle<span class="ot">=</span><span class="fu">residuals</span>(mod.hurdleLR,<span class="st">&quot;response&quot;</span>)</span>
<span id="cb120-3"><a href="spatial-modeling-leukemia.html#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod.hurdleLR)</span></code></pre></div>
<pre><code>## 
## Call:
## hurdle(formula = NCases ~ IICA_High + UBN + Per_Rur + offset(log(EsperadosNCancer)) | IICA_High + UBN + 
##     Per_Rur + offset(log(EsperadosNCancer)), data = muncol, dist = &quot;poisson&quot;, zero.dist = &quot;binomial&quot;)
## 
## Pearson residuals:
##     Min      1Q  Median      3Q     Max 
## -3.6935 -0.7943 -0.3775  0.6266 17.7799 
## 
## Count model coefficients (truncated poisson with log link):
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  0.3151943  0.0289252  10.897   &lt;2e-16 ***
## IICA_High1   0.0769858  0.0309613   2.487   0.0129 *  
## UBN         -0.0123171  0.0011548 -10.666   &lt;2e-16 ***
## Per_Rur      0.0020604  0.0008876   2.321   0.0203 *  
## Zero hurdle model coefficients (binomial with logit link):
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.001514   0.249402   4.016 5.93e-05 ***
## IICA_High1   0.072259   0.137921   0.524    0.600    
## UBN         -0.013830   0.003541  -3.906 9.39e-05 ***
## Per_Rur     -0.004660   0.003364  -1.385    0.166    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 
## 
## Number of iterations in BFGS optimization: 9 
## Log-likelihood: -2051 on 8 Df</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="spatial-modeling-leukemia.html#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pR2</span>(mod.hurdleLR)</span></code></pre></div>
<pre><code>## fitting null model for pseudo-r2</code></pre>
<pre><code>##           llh       llhNull            G2      McFadden          r2ML          r2CU 
## -2051.4697559 -9229.3509481 14355.7623845     0.7777233     0.9999972     0.9999972</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="spatial-modeling-leukemia.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(resid_Pois_Hurdle, mat[[<span class="fu">which.max</span>(aux)]], <span class="at">alternative=</span><span class="st">&quot;two.sided&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Moran I test under randomisation
## 
## data:  resid_Pois_Hurdle  
## weights: mat[[which.max(aux)]]    
## 
## Moran I statistic standard deviate = 4.5053, p-value = 6.627e-06
## alternative hypothesis: two.sided
## sample estimates:
## Moran I statistic       Expectation          Variance 
##       0.158812671      -0.000890472       0.001256531</code></pre>
<ul>
<li><strong><em>Thus, residuals are significantly spatially autocorrelated. So, we are going tu use spatial filtering. Below we find Moran Eigenvectors.</em></strong></li>
</ul>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="spatial-modeling-leukemia.html#cb127-1" aria-hidden="true" tabindex="-1"></a>MEpoisLR <span class="ot">&lt;-</span> spatialreg<span class="sc">::</span><span class="fu">ME</span>(NCases <span class="sc">~</span> IICA_High<span class="sc">+</span>UBN<span class="sc">+</span>Per_Rur<span class="sc">+</span><span class="fu">offset</span>(<span class="fu">log</span>(EsperadosNCancer)),<span class="at">data=</span>muncol,<span class="at">family=</span><span class="st">&quot;poisson&quot;</span>,<span class="at">listw=</span>mat[[<span class="dv">3</span>]], <span class="at">alpha=</span><span class="fl">0.02</span>, <span class="at">verbose=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## eV[,29], I: 0.01179903 ZI: NA, pr(ZI): 0.18</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="spatial-modeling-leukemia.html#cb129-1" aria-hidden="true" tabindex="-1"></a>MoranEigenVLR<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">fitted</span>(MEpoisLR))</span></code></pre></div>
<ul>
<li><strong><em>Now, we used Poisson Hurdle model to manage the overdispersion due to zero excess and Moran eigenfunctions are included as additional explanatory variables, so that spatial autocorrelation is considered.</em></strong></li>
</ul>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="spatial-modeling-leukemia.html#cb130-1" aria-hidden="true" tabindex="-1"></a>mod.hurdleLR <span class="ot">&lt;-</span> <span class="fu">hurdle</span>(NCases <span class="sc">~</span>IICA_High<span class="sc">+</span>UBN<span class="sc">+</span>Per_Rur<span class="sc">+</span><span class="fu">fitted</span>(MEpoisLR)<span class="sc">+</span><span class="fu">offset</span>(<span class="fu">log</span>(EsperadosNCancer))<span class="sc">|</span>Per_Rur<span class="sc">+</span><span class="fu">offset</span>(<span class="fu">log</span>(EsperadosNCancer)),<span class="at">data =</span> muncol,<span class="at">dist =</span> <span class="st">&quot;poisson&quot;</span>, <span class="at">zero.dist =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb130-2"><a href="spatial-modeling-leukemia.html#cb130-2" aria-hidden="true" tabindex="-1"></a>resid_Pois_Hurdle<span class="ot">=</span><span class="fu">residuals</span>(mod.hurdleLR,<span class="st">&quot;response&quot;</span>)</span>
<span id="cb130-3"><a href="spatial-modeling-leukemia.html#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(resid_Pois_Hurdle, mat[[<span class="dv">3</span>]], <span class="at">alternative=</span><span class="st">&quot;two.sided&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Moran I test under randomisation
## 
## data:  resid_Pois_Hurdle  
## weights: mat[[3]]    
## 
## Moran I statistic standard deviate = 1.0424, p-value = 0.2972
## alternative hypothesis: two.sided
## sample estimates:
## Moran I statistic       Expectation          Variance 
##      0.0162024286     -0.0008904720      0.0002689009</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="spatial-modeling-leukemia.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod.hurdleLR)</span></code></pre></div>
<pre><code>## 
## Call:
## hurdle(formula = NCases ~ IICA_High + UBN + Per_Rur + fitted(MEpoisLR) + offset(log(EsperadosNCancer)) | 
##     Per_Rur + offset(log(EsperadosNCancer)), data = muncol, dist = &quot;poisson&quot;, zero.dist = &quot;binomial&quot;)
## 
## Pearson residuals:
##     Min      1Q  Median      3Q     Max 
## -3.2263 -0.7927 -0.3875  0.6339 17.8272 
## 
## Count model coefficients (truncated poisson with log link):
##                    Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)       0.2275843  0.0328678   6.924 4.38e-12 ***
## IICA_High1        0.1568024  0.0342051   4.584 4.56e-06 ***
## UBN              -0.0113328  0.0011644  -9.733  &lt; 2e-16 ***
## Per_Rur           0.0016899  0.0008965   1.885   0.0594 .  
## fitted(MEpoisLR)  2.6540637  0.4767638   5.567 2.59e-08 ***
## Zero hurdle model coefficients (binomial with logit link):
##              Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)  0.646903   0.213106   3.036   0.0024 **
## Per_Rur     -0.008731   0.003237  -2.697   0.0070 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 
## 
## Number of iterations in BFGS optimization: 10 
## Log-likelihood: -2044 on 7 Df</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="spatial-modeling-leukemia.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pR2</span>(mod.hurdleLR)</span></code></pre></div>
<pre><code>## fitting null model for pseudo-r2</code></pre>
<pre><code>##           llh       llhNull            G2      McFadden          r2ML          r2CU 
## -2043.6785123 -9229.3509481 14371.3448717     0.7785675     0.9999972     0.9999973</code></pre>
<ul>
<li><strong><em>Rurality is not statistically significant to explain the Leukemia incidence rate. The only predictor statistically significant for zeroes model is rurality. In addition, the Spatial filtering results are the same without this variable.</em></strong></li>
</ul>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="spatial-modeling-leukemia.html#cb137-1" aria-hidden="true" tabindex="-1"></a>MEpoisLR <span class="ot">&lt;-</span> spatialreg<span class="sc">::</span><span class="fu">ME</span>(NCases <span class="sc">~</span> IICA_High<span class="sc">+</span>UBN<span class="sc">+</span><span class="fu">offset</span>(<span class="fu">log</span>(EsperadosNCancer)),<span class="at">data=</span>muncol,<span class="at">family=</span><span class="st">&quot;poisson&quot;</span>,<span class="at">listw=</span>mat[[<span class="dv">3</span>]], <span class="at">alpha=</span><span class="fl">0.02</span>, <span class="at">verbose=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## eV[,29], I: 0.01112525 ZI: NA, pr(ZI): 0.16</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="spatial-modeling-leukemia.html#cb139-1" aria-hidden="true" tabindex="-1"></a>MoranEigenVLR<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">fitted</span>(MEpoisLR))</span>
<span id="cb139-2"><a href="spatial-modeling-leukemia.html#cb139-2" aria-hidden="true" tabindex="-1"></a>mod.hurdleLR <span class="ot">&lt;-</span> <span class="fu">hurdle</span>(NCases <span class="sc">~</span>IICA_High<span class="sc">+</span>UBN<span class="sc">+</span><span class="fu">fitted</span>(MEpoisLR)<span class="sc">+</span><span class="fu">offset</span>(<span class="fu">log</span>(EsperadosNCancer))<span class="sc">|</span>Per_Rur<span class="sc">+</span><span class="fu">offset</span>(<span class="fu">log</span>(EsperadosNCancer)),<span class="at">data =</span> muncol,<span class="at">dist =</span> <span class="st">&quot;poisson&quot;</span>, <span class="at">zero.dist =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb139-3"><a href="spatial-modeling-leukemia.html#cb139-3" aria-hidden="true" tabindex="-1"></a>resid_Pois_Hurdle<span class="ot">=</span><span class="fu">residuals</span>(mod.hurdleLR,<span class="st">&quot;response&quot;</span>)</span>
<span id="cb139-4"><a href="spatial-modeling-leukemia.html#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(resid_Pois_Hurdle, mat[[<span class="dv">3</span>]], <span class="at">alternative=</span><span class="st">&quot;two.sided&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Moran I test under randomisation
## 
## data:  resid_Pois_Hurdle  
## weights: mat[[3]]    
## 
## Moran I statistic standard deviate = 1.2484, p-value = 0.2119
## alternative hypothesis: two.sided
## sample estimates:
## Moran I statistic       Expectation          Variance 
##      0.0194478991     -0.0008904720      0.0002654261</code></pre>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="spatial-modeling-leukemia.html#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod.hurdleLR)</span></code></pre></div>
<pre><code>## 
## Call:
## hurdle(formula = NCases ~ IICA_High + UBN + fitted(MEpoisLR) + offset(log(EsperadosNCancer)) | Per_Rur + 
##     offset(log(EsperadosNCancer)), data = muncol, dist = &quot;poisson&quot;, zero.dist = &quot;binomial&quot;)
## 
## Pearson residuals:
##     Min      1Q  Median      3Q     Max 
## -3.3173 -0.7976 -0.3786  0.6607 18.2757 
## 
## Count model coefficients (truncated poisson with log link):
##                    Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)       0.2143974  0.0321264   6.674 2.50e-11 ***
## IICA_High1        0.1700350  0.0335266   5.072 3.94e-07 ***
## UBN              -0.0097928  0.0008191 -11.955  &lt; 2e-16 ***
## fitted(MEpoisLR)  2.7262303  0.4759204   5.728 1.01e-08 ***
## Zero hurdle model coefficients (binomial with logit link):
##              Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)  0.646903   0.213106   3.036   0.0024 **
## Per_Rur     -0.008731   0.003237  -2.697   0.0070 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 
## 
## Number of iterations in BFGS optimization: 9 
## Log-likelihood: -2045 on 6 Df</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="spatial-modeling-leukemia.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pR2</span>(mod.hurdleLR)</span></code></pre></div>
<pre><code>## fitting null model for pseudo-r2</code></pre>
<pre><code>##           llh       llhNull            G2      McFadden          r2ML          r2CU 
## -2045.4283395 -9229.3509481 14367.8452173     0.7783779     0.9999972     0.9999973</code></pre>
<ul>
<li><strong><em>Hence, Poisson-Hurdle model residuals are not significant spatially autocorrelated. The LR’s positive values depend only on the Index of armed conflict (IICA) and on the unsatisfied basic needs index (UBN) and its zero values depend on the rurality. Note that the model shows good performance, according to pseudo R2 and the comparison between observed and predicted frequencies.</em></strong></li>
</ul>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="spatial-modeling-leukemia.html#cb146-1" aria-hidden="true" tabindex="-1"></a>mf <span class="ot">&lt;-</span> <span class="fu">model.frame</span>(mod.hurdleLR)</span>
<span id="cb146-2"><a href="spatial-modeling-leukemia.html#cb146-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">model.response</span>(mf)</span>
<span id="cb146-3"><a href="spatial-modeling-leukemia.html#cb146-3" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">model.weights</span>(mf)</span>
<span id="cb146-4"><a href="spatial-modeling-leukemia.html#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.null</span>(w)) w <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">NROW</span>(y))</span>
<span id="cb146-5"><a href="spatial-modeling-leukemia.html#cb146-5" aria-hidden="true" tabindex="-1"></a>max0 <span class="ot">&lt;-</span> 20L</span>
<span id="cb146-6"><a href="spatial-modeling-leukemia.html#cb146-6" aria-hidden="true" tabindex="-1"></a>obs <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">xtabs</span>(w <span class="sc">~</span> <span class="fu">factor</span>(y, <span class="at">levels =</span> 0L<span class="sc">:</span>max0)))</span>
<span id="cb146-7"><a href="spatial-modeling-leukemia.html#cb146-7" aria-hidden="true" tabindex="-1"></a>exp <span class="ot">&lt;-</span> <span class="fu">colSums</span>(<span class="fu">predict</span>(mod.hurdleLR, <span class="at">type =</span> <span class="st">&quot;prob&quot;</span>, <span class="at">at =</span> 0L<span class="sc">:</span>max0) <span class="sc">*</span> w)</span>
<span id="cb146-8"><a href="spatial-modeling-leukemia.html#cb146-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-9"><a href="spatial-modeling-leukemia.html#cb146-9" aria-hidden="true" tabindex="-1"></a>fitted_vs_observed <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Expected =</span> exp,</span>
<span id="cb146-10"><a href="spatial-modeling-leukemia.html#cb146-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">Observed =</span> obs)</span>
<span id="cb146-11"><a href="spatial-modeling-leukemia.html#cb146-11" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(fitted_vs_observed)</span></code></pre></div>
<pre><code>## No id variables; using all as measure variables</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="spatial-modeling-leukemia.html#cb148-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(data, <span class="at">x =</span>  <span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb148-2"><a href="spatial-modeling-leukemia.html#cb148-2" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> data[<span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>, ]</span>
<span id="cb148-3"><a href="spatial-modeling-leukemia.html#cb148-3" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> data[<span class="dv">22</span><span class="sc">:</span><span class="dv">42</span>, ]</span>
<span id="cb148-4"><a href="spatial-modeling-leukemia.html#cb148-4" aria-hidden="true" tabindex="-1"></a>pl1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb148-5"><a href="spatial-modeling-leukemia.html#cb148-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(data1, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value, <span class="at">group =</span> variable</span>
<span id="cb148-6"><a href="spatial-modeling-leukemia.html#cb148-6" aria-hidden="true" tabindex="-1"></a>                          , <span class="at">color =</span> variable)) <span class="sc">+</span></span>
<span id="cb148-7"><a href="spatial-modeling-leukemia.html#cb148-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(data1, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value, <span class="at">group =</span> variable,</span>
<span id="cb148-8"><a href="spatial-modeling-leukemia.html#cb148-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">color =</span> variable)) <span class="sc">+</span></span>
<span id="cb148-9"><a href="spatial-modeling-leukemia.html#cb148-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(data2, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value, <span class="at">group =</span> variable),</span>
<span id="cb148-10"><a href="spatial-modeling-leukemia.html#cb148-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb148-11"><a href="spatial-modeling-leukemia.html#cb148-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb148-12"><a href="spatial-modeling-leukemia.html#cb148-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of cases&quot;</span>,</span>
<span id="cb148-13"><a href="spatial-modeling-leukemia.html#cb148-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Frecuencies&quot;</span>)</span>
<span id="cb148-14"><a href="spatial-modeling-leukemia.html#cb148-14" aria-hidden="true" tabindex="-1"></a>pl1</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="simulación-proceso-espacio-temporal.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="modelos-de-regresión-espacial.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/mpbohorquezc/Clases-EE-UN/edit/master/02-Leukimia.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/mpbohorquezc/Clases-EE-UN/blob/master/02-Leukimia.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
